<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<title>Flowable CMMN DOCS (v 6.2.1)</title>
<style>

/* normalize.css */

button,hr,input{overflow:visible}audio,canvas,progress,video{display:inline-block}progress,sub,sup{vertical-align:baseline}html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0} menu,article,aside,details,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{}button,select{text-transform:none}[type=submit], [type=reset],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:ButtonText dotted 1px}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}[hidden],template{display:none}/*# sourceMappingURL=normalize.min.css.map */

/* tocbot 2.1.4 */

.toc{overflow-y:auto}.toc>ul{overflow:hidden;position:relative}.toc-list{margin:0;padding-left:10px}a.toc-link{color:currentColor;height:100%}.is-collapsible{max-height:1000px;overflow:hidden;transition:all 300ms ease-in-out}.is-collapsed{max-height:0}.is-position-fixed{position:fixed !important;top:0}.is-active-link{font-weight:700}.toc-link::before{background-color:#f9f9fb;content:' ';display:inline-block;height:inherit;left:8px;margin-top:-1px;position:absolute;width:2px}.is-active-link::before{background-color:#54BC4B}


/* Activiti Specific */

body {
  color: #494d55;
  font-size: 16px;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

html, body {
  height: 100%;
  width: 100%;
  background: #f9f9f9;
  font-family: "Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;
  color: #484848
}

.page-wrapper {
  min-height: 100%;
  /* equal to footer height */
  margin-bottom: -50px;
}

.page-wrapper:after {
  content: "";
  display: block;
  height: 50px;
}

#header {
  position:fixed;
  top:0px;
  z-index:100000;
  width:100%;
}

#header > h1 {
    background: #a0cc47;
    color: #f9f9f9;
    border-bottom: 2px solid #042944;
    padding: 20px 0 20px 20px;
    font-size: 40px;
    font-weight: 800;
    line-height: 1.1;
    margin: 0;
}

#header > h1:before {
  background:url('images/logo.png');
  background-size: 337px 54px; background-repeat: no-repeat;
  width: 337px;
  height: 54px;
  display:inline-block;
  content:'';
  margin-right: 30px;
}

#author {
  margin-left: 25%;
  font-size: 40px;
}

#content {
  margin: 129px 0 0 27%;
  padding: 10px 40px 0 20px;
  padding-right: 40px;
  line-height: 1.7;
  width: 65%;
  overflow-x: auto;
}

h2, h3, h4, h5, h6 {
  color: #00345a;
}

h2 {
  font-size: 26px;
  margin-top: 0;
  margin-bottom: 20px;
  font-weight: bold;
  padding-bottom: 10px;
  border-bottom: 1px solid #d7d7d7;
}

h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 0;
  font-weight: bold;
  padding-bottom: 10px;
  /*border-bottom: 1px solid #d7d7d7;*/
}

h4 {
    font-size: 16px;
    font-weight: bold;
}

h5 {
    font-size: 14px;
    font-weight: bold;
}

h6, h7 {
    font-size: 14px;
    font-weight: bold;
    margin-top: 0;
    margin-bottom: 0;
}

.sect1, .sect2 {
  margin-bottom: 20px;
}

.clear
{
  clear: both;
}

.note, .listingblock, .literalblock{
  padding-left: 8px;
  padding-right: 8px;
  margin-bottom: 14px;
  background-color: #f7f7f9;
  border: 1px solid #e1e1e8;
  border-radius: 4px;
  color: #808080;
}

table.tableblock {
  width: 100%;
  max-width: 100%;
  margin-bottom: 20px;
  background-color: transparent;
  border-spacing: 0;
  border-collapse: collapse;
  border: 1px solid #ddd;
  table-layout: fixed;
}

table.tableblock>caption+thead>tr:first-child>td, table.tableblock>caption+thead>tr:first-child>th, table.tableblock>colgroup+thead>tr:first-child>td, table.tableblock>colgroup+thead>tr:first-child>th, table.tableblock>thead:first-child>tr:first-child>td, table.tableblock>thead:first-child>tr:first-child>th {
    border-top: 0;
}

table.tableblock > thead > tr > th {
    border-bottom-color: #8bd6d8;
}

table.tableblock>thead>tr>th {
    vertical-align: bottom;
    border-bottom: 1px solid #ddd;
}

table.tableblock>tbody>tr>td, table.tableblock>tbody>tr>th, table.tableblock>tfoot>tr>td, table.tableblock>tfoot>tr>th, table.tableblock>thead>tr>td, table.tableblock>thead>tr>th {
    padding: 8px;
    line-height: 1.42857143;
    vertical-align: top;
    border-top: 1px solid #ddd;
}

th {
    text-align: left;
}

table.tableblock > tbody > tr:nth-of-type(odd) {
    background-color: #f5f5f5;
}

table.tableblock > tbody > tr:nth-of-type(odd) {
    background-color: #f9f9f9;
}

td > p {
  margin:0;
}

td.content {
  white-space: normal;
}

pre, td, th {
   white-space: pre-wrap;
   white-space: -moz-pre-wrap;
   white-space: -pre-wrap;
   white-space: -o-pre-wrap;
   word-wrap: break-word;
}

img {
  max-width: 100%;
}

a {
  color: #007387;
}

a:hover {
  color: #004c59;
}

#toc-parent {
  width: 25%;
  float: left;
  height: 100%;
  overflow-y: auto;
  position: fixed;
  padding: 10px;
  border-right: 1px solid #ccc;
}

#generated-toc {
    width: 100%;
    height: 100%;
    font-size: 16px;
}

.toc-link {
  text-decoration: none;
}

.toc-list {
  margin: 0 20px 0 10px;
}

.toc-list-item {
  padding: 4px 0 4px 0;
}


div.sect5  p {
    margin-top: 0;
    margin-bottom: 0;
}

div.sect5  code {
    font-family: "Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;
}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>
.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments, .listingblock .pygments code { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sa { color: #BA2121 } /* Literal.String.Affix */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-dl { color: #BA2121 } /* Literal.String.Delimiter */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-fm { color: #0000FF } /* Name.Function.Magic */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-vm { color: #19177C } /* Name.Variable.Magic */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
<script type="text/javascript">

/*
 * Tocbot.min.js version 2.1.4
 */

 !function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([/*!*************************!*\
   !*** ./src/js/index.js ***!
   \*************************/
 function(e,t,n){var o,i,r;(function(l){!function(n,l){i=[],o=l(n),r="function"==typeof o?o.apply(t,i):o,!(void 0!==r&&(e.exports=r))}("undefined"!=typeof l?l:this.window||this.global,function(e){"use strict";function t(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var o in n)h.call(n,o)&&(e[o]=n[o])}return e}function o(e,t,n){t||(t=250);var o,i;return function(){var r=n||this,l=+new Date,s=arguments;o&&l<o+t?(clearTimeout(i),i=setTimeout(function(){o=l,e.apply(r,s)},t)):(o=l,e.apply(r,s))}}var i,r,l,s=n(/*! smooth-scroll */1),c=n(/*! ./default-options.js */2),a={},u={},d=n(/*! ./build-html.js */3),f=n(/*! ./parse-content.js */4),m=(e.document,document.body,!!e.document.querySelector&&!!e.addEventListener),h=Object.prototype.hasOwnProperty;return u.destroy=function(){try{document.querySelector(a.tocSelector).innerHTML=""}catch(e){console.warn("Element not found: "+a.tocSelector)}document.removeEventListener("scroll",this._scrollListener,!1),document.removeEventListener("resize",this._scrollListener,!1),i&&document.removeEventListener("click",this._clickListener,!1),s&&s.destroy()},u.init=function(e){if(m&&(a=t(c,e||{}),this.options=a,this.state={},i=d(a),r=f(a),this._buildHtml=i,this._parseContent=r,u.destroy(),l=r.selectHeadings(a.contentSelector,a.headingSelector),null!==l)){var n=r.nestHeadingsArray(l),h=n.nest;return i.render(a.tocSelector,h),this._scrollListener=o(function(){i.updateToc(l)},a.throttleTimeout),this._scrollListener(),document.addEventListener("scroll",this._scrollListener,!1),document.addEventListener("resize",this._scrollListener,!1),this._clickListener=o(function(e){i.disableTocAnimation(e),i.updateToc(l)},a.throttleTimeout),document.addEventListener("click",this._clickListener,!1),s&&(this.smoothScroll=s.init(t(a.smoothScrollOptions,{callback:i.enableTocAnimation}))),this}},u.refresh=function(e){u.destroy(),u.init(e||this.options)},e.tocbot=u,u})}).call(t,function(){return this}())},/*!******************************************************!*\
   !*** ./~/smooth-scroll/dist/js/smooth-scroll.min.js ***!
   \******************************************************/
 function(e,t,n){var o,i,r;(function(n){/*! smooth-scroll v10.0.1 | (c) 2016 Chris Ferdinandi | MIT License | http://github.com/cferdinandi/smooth-scroll */
 !function(n,l){i=[],o=l(n),r="function"==typeof o?o.apply(t,i):o,!(void 0!==r&&(e.exports=r))}("undefined"!=typeof n?n:this.window||this.global,function(e){"use strict";var t,n,o,i,r,l,s,c={},a="querySelector"in document&&"addEventListener"in e,u={selector:"[data-scroll]",selectorHeader:null,speed:500,easing:"easeInOutCubic",offset:0,callback:function(){}},d=function(){var e={},t=!1,n=0,o=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(t=arguments[0],n++);for(var i=function(n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t&&"[object Object]"===Object.prototype.toString.call(n[o])?e[o]=d(!0,e[o],n[o]):e[o]=n[o])};o>n;n++){var r=arguments[n];i(r)}return e},f=function(e){return Math.max(e.scrollHeight,e.offsetHeight,e.clientHeight)},m=function(e,t){var n,o,i=t.charAt(0),r="classList"in document.documentElement;for("["===i&&(t=t.substr(1,t.length-2),n=t.split("="),n.length>1&&(o=!0,n[1]=n[1].replace(/"/g,"").replace(/'/g,"")));e&&e!==document&&1===e.nodeType;e=e.parentNode){if("."===i)if(r){if(e.classList.contains(t.substr(1)))return e}else if(new RegExp("(^|\\s)"+t.substr(1)+"(\\s|$)").test(e.className))return e;if("#"===i&&e.id===t.substr(1))return e;if("["===i&&e.hasAttribute(n[0])){if(!o)return e;if(e.getAttribute(n[0])===n[1])return e}if(e.tagName.toLowerCase()===t)return e}return null},h=function(e){"#"===e.charAt(0)&&(e=e.substr(1));for(var t,n=String(e),o=n.length,i=-1,r="",l=n.charCodeAt(0);++i<o;){if(t=n.charCodeAt(i),0===t)throw new InvalidCharacterError("Invalid character: the input contains U+0000.");r+=t>=1&&31>=t||127==t||0===i&&t>=48&&57>=t||1===i&&t>=48&&57>=t&&45===l?"\\"+t.toString(16)+" ":t>=128||45===t||95===t||t>=48&&57>=t||t>=65&&90>=t||t>=97&&122>=t?n.charAt(i):"\\"+n.charAt(i)}return"#"+r},p=function(e,t){var n;return"easeInQuad"===e&&(n=t*t),"easeOutQuad"===e&&(n=t*(2-t)),"easeInOutQuad"===e&&(n=.5>t?2*t*t:-1+(4-2*t)*t),"easeInCubic"===e&&(n=t*t*t),"easeOutCubic"===e&&(n=--t*t*t+1),"easeInOutCubic"===e&&(n=.5>t?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1),"easeInQuart"===e&&(n=t*t*t*t),"easeOutQuart"===e&&(n=1- --t*t*t*t),"easeInOutQuart"===e&&(n=.5>t?8*t*t*t*t:1-8*--t*t*t*t),"easeInQuint"===e&&(n=t*t*t*t*t),"easeOutQuint"===e&&(n=1+--t*t*t*t*t),"easeInOutQuint"===e&&(n=.5>t?16*t*t*t*t*t:1+16*--t*t*t*t*t),n||t},v=function(e,t,n){var o=0;if(e.offsetParent)do o+=e.offsetTop,e=e.offsetParent;while(e);return o=Math.max(o-t-n,0),Math.min(o,b()-g())},g=function(){return Math.max(document.documentElement.clientHeight,e.innerHeight||0)},b=function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)},C=function(e){return e&&"object"==typeof JSON&&"function"==typeof JSON.parse?JSON.parse(e):{}},S=function(e){return e?f(e)+e.offsetTop:0},y=function(t,n,o){o||(t.focus(),document.activeElement.id!==t.id&&(t.setAttribute("tabindex","-1"),t.focus(),t.style.outline="none"),e.scrollTo(0,n))};c.animateScroll=function(n,o,l){var c=C(o?o.getAttribute("data-options"):null),a=d(t||u,l||{},c),f="[object Number]"===Object.prototype.toString.call(n),m=f||!n.tagName?null:n;if(f||m){var h=e.pageYOffset;a.selectorHeader&&!i&&(i=document.querySelector(a.selectorHeader)),r||(r=S(i));var g,x,N=f?n:v(m,r,parseInt(a.offset,10)),L=N-h,O=b(),E=0,A=function(t,i,r){var l=e.pageYOffset;(t==i||l==i||e.innerHeight+l>=O)&&(clearInterval(r),y(n,i,f),a.callback(n,o))},H=function(){E+=16,g=E/parseInt(a.speed,10),g=g>1?1:g,x=h+L*p(a.easing,g),e.scrollTo(0,Math.floor(x)),A(x,N,s)},T=function(){clearInterval(s),s=setInterval(H,16)};0===e.pageYOffset&&e.scrollTo(0,0),T()}};var x=function(t){e.location.hash,n&&(n.id=n.getAttribute("data-scroll-id"),c.animateScroll(n,o),n=null,o=null)},N=function(i){if(0===i.button&&!i.metaKey&&!i.ctrlKey&&(o=m(i.target,t.selector),o&&"a"===o.tagName.toLowerCase()&&o.hostname===e.location.hostname&&o.pathname===e.location.pathname&&/#/.test(o.href))){var r=h(o.hash);if("#"===r){i.preventDefault(),n=document.body;var l=n.id?n.id:"smooth-scroll-top";return n.setAttribute("data-scroll-id",l),n.id="",void(e.location.hash.substring(1)===l?x():e.location.hash=l)}n=document.querySelector(r),n&&(n.setAttribute("data-scroll-id",n.id),n.id="",o.hash===e.location.hash&&(i.preventDefault(),x()))}},L=function(e){l||(l=setTimeout(function(){l=null,r=S(i)},66))};return c.destroy=function(){t&&(document.removeEventListener("click",N,!1),e.removeEventListener("resize",L,!1),t=null,n=null,o=null,i=null,r=null,l=null,s=null)},c.init=function(n){a&&(c.destroy(),t=d(u,n||{}),i=t.selectorHeader?document.querySelector(t.selectorHeader):null,r=S(i),document.addEventListener("click",N,!1),e.addEventListener("hashchange",x,!1),i&&e.addEventListener("resize",L,!1))},c})}).call(t,function(){return this}())},/*!***********************************!*\
   !*** ./src/js/default-options.js ***!
   \***********************************/
 function(e,t){e.exports={tocSelector:".js-toc",contentSelector:".js-toc-content",headingSelector:"h1, h2, h3",ignoreSelector:".js-toc-ignore",linkClass:"toc-link",extraLinkClasses:"",activeLinkClass:"is-active-link",listClass:"toc-list",extraListClasses:"",isCollapsedClass:"is-collapsed",collapsibleClass:"is-collapsible",listItemClass:"toc-list-item",collapseDepth:0,smoothScrollOptions:{easing:"easeInOutCubic",offset:0,speed:300,updateURL:!0},headingsOffset:0,throttleTimeout:50,positionFixedSelector:null,positionFixedClass:"is-position-fixed",fixedSidebarOffset:"auto",includeHtml:!1}},/*!******************************!*\
   !*** ./src/js/build-html.js ***!
   \******************************/
 function(e,t){e.exports=function(e){function t(e,n){var r=n.appendChild(o(e));if(e.children.length){var l=i(e.isCollapsed);e.children.forEach(function(e){t(e,l)}),r.appendChild(l)}}function n(e,n){var o=!1,r=i(o);n.forEach(function(e){t(e,r)});var l=document.querySelector(e);if(null!==l)return l.firstChild&&l.removeChild(l.firstChild),l.appendChild(r)}function o(t){var n=document.createElement("li"),o=document.createElement("a");return e.listItemClass&&n.setAttribute("class",e.listItemClass),e.includeHtml&&t.childNodes.length?u.call(t.childNodes,function(e){o.appendChild(e.cloneNode(!0))}):o.textContent=t.textContent,o.setAttribute("data-scroll",""),o.setAttribute("href","#"+t.id),o.setAttribute("class",e.linkClass+h+"node-name--"+t.nodeName+h+e.extraLinkClasses),n.appendChild(o),n}function i(t){var n=document.createElement("ul"),o=e.listClass+h+e.extraListClasses;return t&&(o+=h+e.collapsibleClass,o+=h+e.isCollapsedClass),n.setAttribute("class",o),n}function r(){var t=document.documentElement.scrollTop||f.scrollTop,n=document.querySelector(e.positionFixedSelector);"auto"===e.fixedSidebarOffset&&(e.fixedSidebarOffset=document.querySelector(e.tocSelector).offsetTop),t>e.fixedSidebarOffset?n.className.indexOf(e.positionFixedClass)===-1&&(n.className+=h+e.positionFixedClass):n.className=n.className.split(h+e.positionFixedClass).join("")}function l(t){var n=document.documentElement.scrollTop||f.scrollTop;e.positionFixedSelector&&r();var o,i=t;if(m&&null!==document.querySelector(e.tocSelector)&&i.length>0){d.call(i,function(t,r){if(t.offsetTop>n+e.headingsOffset){var l=0===r?r:r-1;return o=i[l],!0}if(r===i.length-1)return o=i[i.length-1],!0});var l=document.querySelector(e.tocSelector).querySelectorAll("."+e.linkClass);u.call(l,function(t){t.className=t.className.split(h+e.activeLinkClass).join("")});var c=document.querySelector(e.tocSelector).querySelector("."+e.linkClass+".node-name--"+o.nodeName+'[href="#'+o.id+'"]');c.className+=h+e.activeLinkClass;var a=document.querySelector(e.tocSelector).querySelectorAll("."+e.listClass+"."+e.collapsibleClass);u.call(a,function(t){var n=h+e.isCollapsedClass;t.className.indexOf(n)===-1&&(t.className+=h+e.isCollapsedClass)}),c.nextSibling&&(c.nextSibling.className=c.nextSibling.className.split(h+e.isCollapsedClass).join("")),s(c.parentNode.parentNode)}}function s(t){return t.className.indexOf(e.collapsibleClass)!==-1?(t.className=t.className.split(h+e.isCollapsedClass).join(""),s(t.parentNode.parentNode)):t}function c(t){var n=t.target||t.srcElement;n.className.indexOf(e.linkClass)!==-1&&(m=!1)}function a(){m=!0}var u=[].forEach,d=[].some,f=document.body,m=!0,h=" ";return{enableTocAnimation:a,disableTocAnimation:c,render:n,updateToc:l}}},/*!*********************************!*\
   !*** ./src/js/parse-content.js ***!
   \*********************************/
 function(e,t){e.exports=function(e){function t(e){return e[e.length-1]}function n(e){return+e.nodeName.split("H").join("")}function o(t){var o={id:t.id,children:[],nodeName:t.nodeName,headingLevel:n(t),textContent:t.textContent.trim()};return e.includeHtml&&(o.childNodes=t.childNodes),o}function i(i,r){for(var l=o(i),s=n(i),c=r,a=t(c),u=a?a.headingLevel:0,d=s-u;d>0;)a=t(c),a&&void 0!==a.children&&(c=a.children),d--;return s>=e.collapseDepth&&(l.isCollapsed=!0),c.push(l),c}function r(t,n){var o=n;e.ignoreSelector&&(o=n.split(",").map(function(t){return t.trim()+":not("+e.ignoreSelector+")"}));try{return document.querySelector(t).querySelectorAll(o)}catch(i){return console.warn("Element not found: "+t),null}}function l(e){return s.call(e,function(e,t){var n=o(t);return i(n,e.nest),e},{nest:[]})}var s=[].reduce;return{nestHeadingsArray:l,selectHeadings:r}}}]);
 //# sourceMappingURL=tocbot.min.js.map

</script>

<script type="text/javascript">

  var generateToc = function() {
    var readyState = document.readyState;
    if (readyState === 'interactive' || readyState == 'complete') {

      var headerSize = 140;

      var tocParentNode = document.createElement("div");
      tocParentNode.setAttribute("id", "toc-parent");

      var generatedTocNode = document.createElement("div");
      generatedTocNode.setAttribute("id", "generated-toc");
      tocParentNode.appendChild(generatedTocNode);

      var contentNode = document.getElementById("content");
      contentNode.parentNode.insertBefore(tocParentNode, contentNode);

      var clearNode = document.createElement("div");
      clearNode.setAttribute("class", "clear");
      contentNode.parentNode.appendChild(clearNode);

      tocbot.init({
        tocSelector: '#generated-toc',
        contentSelector: '#content',
        headingSelector: 'h2, h3, h4, h5',
        headingsOffset: headerSize,
        smoothScrollOptions: {
          easing: 'easeInOutCubic',
          offset: headerSize,
          speed: 300, // animation duration.
          updateURL: true
        },
        collapseDepth: 0
      });

    } else {
      window.setTimeout(function(){
        generateToc();
      }, 50);
    }

  }
  generateToc();

</script>
</head>
<body class="book">
<div id="header">
<h1>Flowable CMMN DOCS (v 6.2.1)</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="license">1.1. License</h3>
<div class="paragraph">
<p>Flowable is distributed under <a href="http://www.apache.org/licenses/LICENSE-2.0.html">the Apache V2 license</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="download">1.2. Download</h3>
<div class="paragraph">
<p><a href="http://flowable.org/downloads.html"><a href="http://flowable.org/downloads.html" class="bare">http://flowable.org/downloads.html</a></a></p>
</div>
</div>
<div class="sect2">
<h3 id="sources">1.3. Sources</h3>
<div class="paragraph">
<p>The distribution contains most of the sources as JAR files. The source code of Flowable can be found on <a href="https://github.com/flowable/flowable-engine"><a href="https://github.com/flowable/flowable-engine" class="bare">https://github.com/flowable/flowable-engine</a></a></p>
</div>
</div>
<div class="sect2">
<h3 id="experimental">1.4. Experimental Release</h3>
<div class="paragraph">
<p>This is the first release of Flowable containing the CMMN engine, which is currently marked as experimental.
Similar to experimental features in the other engines, this means that no stability guarantees are given with regards to backwards compatibility (packages, classes, data),
as we want to use this release to gather feedback from the community before making the API&#8217;s fully final. However, future release notes will describe the changes if any such changes are made.</p>
</div>
<div class="paragraph">
<p>In the next releases, we will enhance and expand on the CMMN 1.1 support and continue to add more features.</p>
</div>
</div>
<div class="sect2">
<h3 id="required.software">1.5. Required software</h3>
<div class="paragraph">
<p>Flowable runs on a JDK higher than or equal to version 7.  Go to <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Oracle Java SE downloads</a> and click on button "Download JDK".  There are installation instructions on that page as well. To verify that your installation was successful, run <code>java -version</code> on the command line.  That should print the installed version of your JDK.</p>
</div>
</div>
<div class="sect2">
<h3 id="reporting.problems">1.6. Reporting problems</h3>
<div class="paragraph">
<p>Questions and comments can be discussed on the on <a href="https://forum.flowable.org">the Flowable forum</a>. Issues can be created in <a href="https://github.com/flowable/flowable-engine/issues">our Github issue tracker</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="internal">1.7. Internal implementation classes</h3>
<div class="paragraph">
<p>In the JAR file, all classes in packages that have <code>.impl.</code> in them are implementation classes and should be considered internal. No stability guarantees are given on classes or interfaces that are in implementation classes.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration">2. Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="configuration">2.1. Creating a CmmnEngine</h3>
<div class="paragraph">
<p>The Flowable CMMN engine is configured through an XML file called <code>flowable.cmmn.cfg.xml</code>. Note that this is <strong>not</strong> applicable if you&#8217;re using <a href="#springintegration">the Spring style of building a process engine</a>.</p>
</div>
<div class="paragraph">
<p>The easiest way to obtain a <code>CmmnEngine</code> is to use the <code>org.flowable.cmmn.engine.CmmnEngineConfiguration</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">CmmnEngine</span> <span class="tok-n">cmmnEngine</span> <span class="tok-o">=</span> <span class="tok-n">CmmnEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneCmmnEngineConfiguration</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>This will look for a <code>flowable.cmmn.cfg.xml</code> file on the classpath and construct an engine based on the configuration in that file. The following snippet shows an example configuration.  The following sections will give a detailed overview of the configuration properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</div></td><td class="code"><span></span><span class="tok-nt">&lt;beans</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="tok-na">xsi:schemaLocation=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.engine.CmmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>

    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUrl&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:h2:mem:flowable;DB_CLOSE_DELAY=1000&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcDriver&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;org.h2.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUsername&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;sa&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcPassword&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseSchemaUpdate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;/beans&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the configuration XML is in fact a Spring configuration. <strong>This does not mean that Flowable can only be used in a Spring environment!</strong> We are simply leveraging the parsing and dependency injection capabilities of Spring internally for building up the engine.</p>
</div>
<div class="paragraph">
<p>The CmmnEngineConfiguration object can also be created programmatically using the configuration file. It is also possible to use a different bean id (for example, see line 3).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-n">CmmnEngineConfiguration</span><span class="tok-o">.</span>
  <span class="tok-nf">createCmmnEngineConfigurationFromResourceDefault</span><span class="tok-o">();</span>
  <span class="tok-n">createCmmnEngineConfigurationFromResource</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">resource</span><span class="tok-o">);</span>
  <span class="tok-n">createCmmnEngineConfigurationFromResource</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">resource</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">beanName</span><span class="tok-o">);</span>
  <span class="tok-n">createCmmnEngineConfigurationFromInputStream</span><span class="tok-o">(</span><span class="tok-n">InputStream</span> <span class="tok-n">inputStream</span><span class="tok-o">);</span>
  <span class="tok-n">createCmmnEngineConfigurationFromInputStream</span><span class="tok-o">(</span><span class="tok-n">InputStream</span> <span class="tok-n">inputStream</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">beanName</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible not to use a configuration file, and create a configuration based on
defaults (see <a href="#configurationClasses">the different supported classes</a> for more information).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-n">CmmnEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneCmmnEngineConfiguration</span><span class="tok-o">();</span>
<span class="tok-n">CmmnEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneInMemCmmnEngineConfiguration</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>All these <code>CmmnEngineConfiguration.createXXX()</code> methods return a <code>CmmnEngineConfiguration</code> that can be tweaked further if needed. After calling the <code>buildCmmnEngine()</code> operation, a <code>CmmnEngine</code> is created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">CmmnEngine</span> <span class="tok-n">cmmnEngine</span> <span class="tok-o">=</span> <span class="tok-n">CmmnEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneInMemCmmnEngineConfiguration</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">setDatabaseSchemaUpdate</span><span class="tok-o">(</span><span class="tok-n">CmmnEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">DB_SCHEMA_UPDATE_TRUE</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">setJdbcUrl</span><span class="tok-o">(</span><span class="tok-s">&quot;jdbc:h2:mem:my-own-db;DB_CLOSE_DELAY=1000&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">buildCmmnEngine</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configurationRoot">2.2. CmmnEngineConfiguration bean</h3>
<div class="paragraph">
<p>The <code>flowable.cmmn.cfg.xml</code> must contain a bean that has the id <code>'cmmnEngineConfiguration'</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span> <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.engine.CmmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>This bean is then used to construct the <code>CmmnEngine</code>. There are multiple classes available that can be used to define the <code>cmmnEngineConfiguration</code>. These classes represent different environments, and set defaults accordingly. It&#8217;s best practice to select the class that best matches your environment, to minimize the number of properties needed to configure the engine. The following classes are currently available: <a id="configurationClasses"></a></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>org.flowable.cmmn.engine.impl.cfg.StandaloneInMemCmmnEngineConfiguration</strong>: this is a convenience class for unit testing purposes. Flowable will take care of all transactions. An H2 in-memory database is used by default. The database will be created and dropped when the engine boots and shuts down. When using this, no additional configuration is probably needed.</p>
</li>
<li>
<p><strong>org.flowable.cmmn.spring.SpringCmmnEngineConfiguration</strong>: To be used when the CMMN engine is used in a Spring environment.  See <a href="#springintegration">the Spring integration section</a> for more information.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="databaseConfiguration">2.3. Database configuration</h3>
<div class="paragraph">
<p>There are two ways to configure the database that the Flowable CMMN engine will use. The first option is to define the JDBC properties of the database:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>jdbcUrl</strong>: JDBC URL of the database.</p>
</li>
<li>
<p><strong>jdbcDriver</strong>: implementation of the driver for the specific database type.</p>
</li>
<li>
<p><strong>jdbcUsername</strong>: username to connect to the database.</p>
</li>
<li>
<p><strong>jdbcPassword</strong>: password to connect to the database.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The data source that is constructed based on the provided JDBC properties will have the default <a href="http://www.mybatis.org/">MyBatis</a> connection pool settings. The following attributes can optionally be set to tweak that connection pool (taken from the MyBatis documentation):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>jdbcMaxActiveConnections</strong>: The number of active connections that the connection pool at maximum at any time can contain. Default is 10.</p>
</li>
<li>
<p><strong>jdbcMaxIdleConnections</strong>: The number of idle connections that the connection pool at maximum at any time can contain.</p>
</li>
<li>
<p><strong>jdbcMaxCheckoutTime</strong>: The amount of time in milliseconds a connection can be <em>checked out</em> from the connection pool before it is forcefully returned. Default is 20000 (20 seconds).</p>
</li>
<li>
<p><strong>jdbcMaxWaitTime</strong>: This is a low level setting that gives the pool a chance to print a log status and re-attempt the acquisition of a connection in the case that it is taking unusually long (to avoid failing silently forever if the pool is misconfigured) Default is 20000 (20 seconds).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example database configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUrl&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:h2:mem:flowable;DB_CLOSE_DELAY=1000&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcDriver&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;org.h2.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUsername&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;sa&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcPassword&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Our benchmarks have shown that the MyBatis connection pool is not the most efficient or resilient when dealing with a lot of concurrent requests. As such, it is advised to us a <code>javax.sql.DataSource</code> implementation and inject it into the process engine configuration (For example DBCP, C3P0, Hikari, Tomcat Connection Pool, etc.):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;driverClassName&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;com.mysql.jdbc.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;url&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:mysql://localhost:3306/flowable&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;username&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;flowable&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;password&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;flowable&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;defaultAutoCommit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;false&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.engine.CmmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-nt">/&gt;</span>
  ...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that Flowable does not ship with a library that allows you to define such a data source. So you need to make sure that the libraries are on your classpath.</p>
</div>
<div class="paragraph">
<p>The following properties can be set, regardless of whether you are using the JDBC or data source approach:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>databaseType</strong>: it&#8217;s normally not necessary to specify this property, as it is automatically detected from the database connection metadata. Should only be specified when automatic detection fails. Possible values: {h2, mysql, oracle, postgres, mssql, db2}. This setting will determine which create/drop scripts and queries will be used. See <a href="#supporteddatabases">the <em>supported databases</em> section</a> for an overview of which types are supported.</p>
</li>
<li>
<p><strong>databaseSchemaUpdate</strong>: sets the strategy to handle the database schema on process engine boot and shutdown.</p>
<div class="ulist">
<ul>
<li>
<p><code>false</code> (default): Checks the version of the DB schema against the library when the process engine is being created and throws an exception if the versions don&#8217;t match.</p>
</li>
<li>
<p><code>true</code>: Upon building the process engine, a check is performed and an update of the schema is performed if it is necessary. If the schema doesn&#8217;t exist, it is created.</p>
</li>
<li>
<p><code>create-drop</code>: Creates the schema when the process engine is being created and drops the schema when the process engine is being closed.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="jndiDatasourceConfig">2.4. JNDI Datasource Configuration</h3>
<div class="paragraph">
<p>By default, the database configuration for Flowable is contained within the db.properties files in the WEB-INF/classes of each web application. This isn&#8217;t always ideal because it
requires users to either modify the db.properties in the Flowable source and recompile the WAR file, or explode the WAR and modify the db.properties on every deployment.</p>
</div>
<div class="paragraph">
<p>By using JNDI (Java Naming and Directory Interface) to obtain the database connection, the connection is fully managed by the Servlet Container and the configuration can be managed outside the WAR deployment. This also allows more control over the connection parameters than what is provided by the db.properties file.</p>
</div>
<div class="sect3">
<h4 id="jndi_configuration">2.4.1. Configuration</h4>
<div class="paragraph">
<p>Configuration of the JNDI data source will differ depending on what servlet container application you are using. The instructions below will work for Tomcat, but for other container applications, please refer to the documentation for your container app.</p>
</div>
<div class="paragraph">
<p>If using Tomcat, the JNDI resource is configured within $CATALINA_BASE/conf/[enginename]/[hostname]/[warname].xml (for the Flowable UI this will usually be $CATALINA_BASE/conf/Catalina/localhost/flowable-app.xml). The default context is copied from the Flowable WAR file when the application is first deployed, so if it already exists, you will need to replace it. To change the JNDI resource so that the application connects to MySQL instead of H2, for example, change the file to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span></span><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
    <span class="tok-nt">&lt;Context</span> <span class="tok-na">antiJARLocking=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-na">path=</span><span class="tok-s">&quot;/flowable-app&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;Resource</span> <span class="tok-na">auth=</span><span class="tok-s">&quot;Container&quot;</span>
            <span class="tok-na">name=</span><span class="tok-s">&quot;jdbc/flowableDB&quot;</span>
            <span class="tok-na">type=</span><span class="tok-s">&quot;javax.sql.DataSource&quot;</span>
            <span class="tok-na">description=</span><span class="tok-s">&quot;JDBC DataSource&quot;</span>
            <span class="tok-na">url=</span><span class="tok-s">&quot;jdbc:mysql://localhost:3306/flowable&quot;</span>
            <span class="tok-na">driverClassName=</span><span class="tok-s">&quot;com.mysql.jdbc.Driver&quot;</span>
            <span class="tok-na">username=</span><span class="tok-s">&quot;sa&quot;</span>
            <span class="tok-na">password=</span><span class="tok-s">&quot;&quot;</span>
            <span class="tok-na">defaultAutoCommit=</span><span class="tok-s">&quot;false&quot;</span>
            <span class="tok-na">initialSize=</span><span class="tok-s">&quot;5&quot;</span>
            <span class="tok-na">maxWait=</span><span class="tok-s">&quot;5000&quot;</span>
            <span class="tok-na">maxActive=</span><span class="tok-s">&quot;120&quot;</span>
            <span class="tok-na">maxIdle=</span><span class="tok-s">&quot;5&quot;</span><span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;/Context&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jndi_properties">2.4.2. JNDI properties</h4>
<div class="paragraph">
<p>To configure a JNDI data source, use following properties in the properties file for the Flowable UI:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>datasource.jndi.name: the JNDI name of the data source.</p>
</li>
<li>
<p>datasource.jndi.resourceRef: Set whether the lookup occurs in a J2EE container, for example, the prefix "java:comp/env/" needs to be added if the JNDI name doesn&#8217;t already contain it. Default is "true".</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="supporteddatabases">2.5. Supported databases</h3>
<div class="paragraph">
<p>Listed below are the types (case sensitive!) that Flowable uses to refer to databases.</p>
</div>
<table id="databaseTypes" class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flowable database type</th>
<th class="tableblock halign-left valign-top">Example JDBC URL</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">h2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:h2:tcp://localhost/flowable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default configured database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mysql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:mysql://localhost:3306/flowable?autoReconnect=true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tested using mysql-connector-java database driver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">oracle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:oracle:thin:@localhost:1521:xe</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">postgres</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:postgresql://localhost:5432/flowable</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">db2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:db2://localhost:50000/flowable</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mssql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:sqlserver://localhost:1433;databaseName=flowable (jdbc.driver=com.microsoft.sqlserver.jdbc.SQLServerDriver) <em>OR</em> jdbc:jtds:sqlserver://localhost:1433/flowable (jdbc.driver=net.sourceforge.jtds.jdbc.Driver)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tested using Microsoft JDBC Driver 4.0 (sqljdbc4.jar) and JTDS Driver</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="creatingDatabaseTable">2.6. Creating the database tables</h3>
<div class="paragraph">
<p>The easiest way to create the database tables for your database is to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the flowable-cmmn-engine JARs to your classpath</p>
</li>
<li>
<p>Add a suitable database driver</p>
</li>
<li>
<p>Add a Flowable configuration file (<em>flowable.cmmn.cfg.xml</em>) to your classpath, pointing to your database (see <a href="#databaseConfiguration">database configuration section</a>)</p>
</li>
<li>
<p>Execute the main method of the <em>DbSchemaCreate</em> class</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, often only database administrators can execute DDL statements on a database. On a production system, this is also the wisest of choices. The SQL DDL statements can be found on the Flowable downloads page or inside the Flowable distribution folder, in the <code>database</code> subdirectory. The scripts are also in the engine JAR (<em>flowable-cmmn-engine-x.jar</em>), in the package <em>org/flowable/cmmn/db/create</em> . The SQL files are of the form</p>
</div>
<div class="listingblock">
<div class="content">
<pre>flowable.{db}.cmmn.create.sql</pre>
</div>
</div>
<div class="paragraph">
<p>Where <em>db</em> is any of the <a href="#supporteddatabases">supported databases</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="database.tables.explained">2.7. Database table names explained</h3>
<div class="paragraph">
<p>The database names of the Flowable CMMN Engine all start with <strong>ACT_CMMN_</strong>. The second part is a two-character identification of the use case of the table. This use case will also roughly match the service API.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ACT_CMMN_</strong>*: Tables without an additional prefix contain <em>static</em> information such as case definitions and case resources (images, rules, etc.).</p>
</li>
<li>
<p><strong>ACT_RU_</strong>*: <em>RU</em> stands for <code>runtime</code>. These are the runtime tables that contain the runtime data of case instances, plan items, and so on. Flowable only stores the runtime data during case instance execution and removes the records when a case instance ends. This keeps the runtime tables small and fast.</p>
</li>
<li>
<p><strong>ACT_HI_</strong>*: <em>HI</em> stands for <code>history</code>. These are the tables that contain historic data, such as past case instances, plan items, and so on.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="databaseUpgrade">2.8. Database upgrade</h3>
<div class="paragraph">
<p>Make sure you make a backup of your database (using your database backup capabilities) before you run an upgrade.</p>
</div>
<div class="paragraph">
<p>By default, a version check will be performed each time a process engine is created. This typically happens once at boot time of your application or of the Flowable webapps. If the Flowable library notices a difference between the library version and the version of the Flowable database tables, then an exception is thrown.</p>
</div>
<div class="paragraph">
<p>To upgrade, you have to start by putting the following configuration property in your flowable.cmmn.cfg.xml configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-nt">&lt;beans</span> <span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span>
      <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.engine.CmmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-c">&lt;!-- ... --&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseSchemaUpdate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-c">&lt;!-- ... --&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;/beans&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Also, include a suitable database driver for your database to the classpath.</strong> Upgrade the Flowable libraries in your application. Or start up a new version of Flowable and point it to a database that contains data from an older version.  With <code>databaseSchemaUpdate</code> set to <code>true</code>, Flowable will automatically upgrade the DB schema to the newest version the first time when it notices that libraries and DB schema are out of sync.</p>
</div>
<div class="paragraph">
<p><strong>As an alternative, you can also run the upgrade DDL statements.</strong> It&#8217;s also possible to run the upgrade database scripts available on the Flowable downloads page.</p>
</div>
</div>
<div class="sect2">
<h3 id="historyConfiguration">2.9. History configuration</h3>
<div class="paragraph">
<p>Customizing the configuration of history storage is optional. This allows you to tweak settings that influence the <a href="#history">history capabilities</a> of the engine. See <a href="#historyConfig">history configuration</a> for more details.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;history&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;audit&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="exposingConfigurationBeans">2.10. Exposing configuration beans in expressions and scripts</h3>
<div class="paragraph">
<p>By default, all beans that you specify in the <code>flowable.cmmn.cfg.xml</code> configuration or in your own Spring configuration file are available to expressions and scripts. If you want to limit the visibility of beans in your configuration file, you can configure a property called <code>beans</code> in your process engine configuration. The beans property in <code>CmmnEngineConfiguration</code> is a map. When you specify that property, only beans specified in that map will be visible to expressions and scripts.  The exposed beans will be exposed with the names as you specify in the map.</p>
</div>
</div>
<div class="sect2">
<h3 id="caseDefinitionCacheConfiguration">2.11. Deployment cache configuration</h3>
<div class="paragraph">
<p>All case definitions are cached (after they&#8217;re parsed) to avoid hitting the database every time a case definition is needed and because case definition data doesn&#8217;t change. By default, there is no limit on this cache. To limit the case definition cache, add following property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;caseDefinitionCacheLimit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;10&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Setting this property will swap the default hashmap cache with a LRU cache that has the provided hard limit. Of course, the <em>best</em> value for this property depends on the total amount of case definitions stored and the number of case definitions actually used at runtime by all the runtime case instances.</p>
</div>
<div class="paragraph">
<p>You can also inject your own cache implementation. This must be a bean that implements the org.flowable.engine.common.impl.persistence.deploy.DeploymentCache interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;caseDefinitionCache&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.MyCache&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/property&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="loggingConfiguration">2.12. Logging</h3>
<div class="paragraph">
<p>All logging (flowable, spring, mybatis, &#8230;&#8203;) is routed through SLF4J and allows for selecting the logging-implementation of your choice.</p>
</div>
<div class="paragraph">
<p><strong>By default no SFL4J-binding JAR is present in the flowable-cmmn-engine dependencies, this should be added in your project in order to use the logging framework of your choice.</strong> If no implementation JAR is added, SLF4J will use a NOP-logger, not logging anything at all, other than a warning that nothing will be logged. For more info on these bindings <a href="http://www.slf4j.org/codes.html#StaticLoggerBinder"><a href="http://www.slf4j.org/codes.html#StaticLoggerBinder" class="bare">http://www.slf4j.org/codes.html#StaticLoggerBinder</a></a>.</p>
</div>
<div class="paragraph">
<p>With Maven, add for example a dependency like this (here using log4j), note that you still need to add a version:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.slf4j<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>slf4j-log4j12<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The flowable-ui and flowable-rest webapps are configured to use Log4j-binding. Log4j is also used when running the tests for all the flowable-* modules.</p>
</div>
<div class="paragraph">
<p><strong>Important note when using a container with commons-logging in the classpath:</strong> In order to route the spring-logging through SLF4J, a bridge is used (see <a href="http://www.slf4j.org/legacy.html#jclOverSLF4J"><a href="http://www.slf4j.org/legacy.html#jclOverSLF4J" class="bare">http://www.slf4j.org/legacy.html#jclOverSLF4J</a></a>). If your container provides a commons-logging implementation, please follow directions on this page: <a href="http://www.slf4j.org/codes.html#release"><a href="http://www.slf4j.org/codes.html#release" class="bare">http://www.slf4j.org/codes.html#release</a></a> to ensure stability.</p>
</div>
<div class="paragraph">
<p>Example when using Maven (version omitted):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.slf4j<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>jcl-over-slf4j<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chapterApi">3. The Flowable CMMN API</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="apiEngine">3.1. The Process CMMN Engine API and services</h3>
<div class="paragraph">
<p>The engine API is the most common way of interacting with Flowable. The main starting point is the <code>CmmnEngine</code>, which can be created in several ways as described in the  <a href="#configuration">configuration section</a>. From the CmmnEngine, you can obtain the various services that contain the case/CMMN methods. CmmnEngine and the services objects are thread safe, so you can keep a reference to one of those for a whole server.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/api.services.png" alt="api.services">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-n">CmmnEngine</span> <span class="tok-n">cmmnEngine</span> <span class="tok-o">=</span> <span class="tok-n">CmmnEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneCmmnEngineConfiguration</span><span class="tok-o">();</span>

<span class="tok-n">CmmnRuntimeService</span> <span class="tok-n">runtimeService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnRuntimeService</span><span class="tok-o">();</span>
<span class="tok-n">CmmnRepositoryService</span> <span class="tok-n">repositoryService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnRepositoryService</span><span class="tok-o">();</span>
<span class="tok-n">CmmnTaskService</span> <span class="tok-n">taskService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnTaskService</span><span class="tok-o">();</span>
<span class="tok-n">CmmnManagementService</span> <span class="tok-n">managementService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnManagementService</span><span class="tok-o">();</span>
<span class="tok-n">CmmnHistoryService</span> <span class="tok-n">historyService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnHistoryService</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>CmmnEngineConfiguration.createStandaloneCmmnEngineConfiguration()</code> will initialize and build a CMMN engine and afterwards always return the CMMN engine.</p>
</div>
<div class="paragraph">
<p>The CmmnEngineConfiguration class will scan for all <code>flowable.cmmn.cfg.xml</code> and <code>flowable-cmmn-context.xml</code> files. For all <code>flowable.cmmn.cfg.xml</code> files, the CMMN engine will be built in the typical Flowable way: <code>CmmnEngineConfiguration.createCmmnEngineConfigurationFromInputStream(inputStream).buildCmmnEngine()</code>. For all <code>flowable-cmmn-context.xml</code> files, the CMMN engine will be built in the Spring way: first the Spring application context is created and then the CMMN engine is obtained from that application context.</p>
</div>
<div class="paragraph">
<p>All services are stateless. This means that you can easily run Flowable on multiple nodes in a cluster, each going to the same database, without having to worry about which machine actually executed previous calls. Any call to any service is idempotent regardless of where it is executed.</p>
</div>
<div class="paragraph">
<p>The <strong>CmmnRepositoryService</strong> is probably the first service needed when working with the Flowable CMMN engine. This service offers operations for managing and manipulating <code>deployments</code> and <code>case definitions</code>. Without going into much detail here, a case definition is a Java counterpart of the CMMN 1.1 case. It is a representation of the structure and behavior of each of the steps of a case. A <code>deployment</code> is the unit of packaging within the Flowable CMMN engine. A deployment can contain multiple CMMN 1.1 XML files and any other resource. The choice of what is included in one deployment is up to the developer. It can range from a single process CMMN 1.1 XML file to a whole package of cases and relevant resources (for example, the deployment <em>hr-cases</em> could contain everything related to HR cases). The <code>CmmnRepositoryService</code> can <code>deploy</code> such packages. Deploying a deployment means it is uploaded to the engine, where all cases are inspected and parsed before being stored in the database. From that point on, the deployment is known to the system and any process included in the deployment can now be started.</p>
</div>
<div class="paragraph">
<p>Furthermore, this service allows you to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Query on deployments and case definitions known to the engine.</p>
</li>
<li>
<p>Retrieve various resources, such as files contained within the deployment or case diagrams that were auto-generated by the engine.</p>
</li>
<li>
<p>Retrieve a POJO version of the case definition, which can be used to introspect the case using Java rather than XML.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While the <code>CmmnRepositoryService</code> is mostly about static information (data that doesn&#8217;t change, or at least not a lot), the <strong>CmmnRuntimeService</strong> is quite the opposite. It deals with starting new case instances of case definitions. As said above, a <code>case definition</code> defines the structure and behavior of the different steps in a case. A case instance is one execution of such a case definition. For each case definition there typically are many instances running at the same time. The <code>CmmnRuntimeService</code> also is the service which is used to retrieve and store <code>case variables</code>. This is data that is specific to the given case instance and can be used by various constructs in the case (for example, a plan transition condition often uses process variables to determine which path is chosen to continue the case). The <code>CmmnRuntimeservice</code> also allows you to query on case instances and plan items. Plan items are a representation of the enabled plan items of CMMN 1.1. Lastly, the <code>CmmnRuntimeService</code> is used whenever a case instance is waiting for an external trigger and the case needs to be continued. A case instance can have various <code>wait states</code> and this service contains various operations to <em>signal</em> to the instance that the external trigger is received and the case instance can be continued.</p>
</div>
<div class="paragraph">
<p>Tasks that need to be performed by human users of the system are core to a CMMN engine such as Flowable. Everything around tasks is grouped in the <strong>CmmnTaskService</strong>, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Querying tasks assigned to users or groups</p>
</li>
<li>
<p>Creating new <em>standalone</em> tasks. These are tasks that are not related to a process instances.</p>
</li>
<li>
<p>Manipulating to which user a task is assigned or which users are in some way involved with the task.</p>
</li>
<li>
<p>Claiming and completing a task. Claiming means that someone decided to be the assignee for the task, meaning that this user will complete the task. Completing means <em>doing the work of the tasks</em>. Typically this is filling in a form of sorts.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <strong>CmmnHistoryService</strong> exposes all historical data gathered by the Flowable CMMN engine. When executing cases, a lot of data can be kept by the engine (this is configurable), such as case instance start times, who did which tasks, how long it took to complete the tasks, which path was followed in each case instance, and so on. This service exposes mainly query  capabilities to access this data.</p>
</div>
<div class="paragraph">
<p>The <strong>CmmnManagementService</strong> is typically not needed when coding custom application using Flowable. It allows the retrieval of information about the database tables and table metadata.</p>
</div>
<div class="paragraph">
<p>For more detailed information on the service operations and the engine API, see <a href="flowable/index.html">the javadocs</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exception_strategy">3.2. Exception strategy</h3>
<div class="paragraph">
<p>The base exception in Flowable is the <code>org.flowable.engine.common.api.FlowableException</code>, an unchecked exception. This exception can be thrown at all times by the API, but <em>expected</em> exceptions that happen in specific methods are documented in the <a href="http://flowable.org/javadocs/index.html"> the javadocs</a>. For example, an extract from <code>CmmnTaskService</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-cm">/**</span>
<span class="tok-cm"> * Called when the task is successfully executed.</span>
<span class="tok-cm"> * @param taskId the id of the task to complete, cannot be null.</span>
<span class="tok-cm"> * @throws FlowableObjectNotFoundException when no task exists with the given id.</span>
<span class="tok-cm"> */</span>
 <span class="tok-kt">void</span> <span class="tok-nf">complete</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">taskId</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, when an id is passed for which no task exists, an exception will be thrown. Also, since the javadoc <strong>explicitly states that taskId cannot be null, an <code>FlowableIllegalArgumentException</code> will be thrown when <code>null</code> is passed</strong>.</p>
</div>
<div class="paragraph">
<p>Even though we want to avoid a big exception hierarchy, the following subclasses are thrown in specific cases. All other errors that occur during process-execution or API-invocation that don&#8217;t fit into the possible exceptions below, are thrown as regular <code>FlowableExceptions</code>s.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>FlowableWrongDbException</code>: Thrown when the Flowable engine discovers a mismatch between the database schema version and the engine version.</p>
</li>
<li>
<p><code>FlowableOptimisticLockingException</code>: Thrown when an optimistic locking occurs in the data store caused by concurrent access of the same data entry.</p>
</li>
<li>
<p><code>FlowableClassLoadingException</code>: Thrown when a class requested to load was not found or when an error occurred while loading it (e.g. JavaDelegates, TaskListeners, &#8230;&#8203;).</p>
</li>
<li>
<p><code>FlowableObjectNotFoundException</code>: Thrown when an object that is requested or actioned does not exist.</p>
</li>
<li>
<p><code>FlowableIllegalArgumentException</code>: An exception indicating that an illegal argument has been supplied in a Flowable API-call, an illegal value was configured in the engine&#8217;s configuration or an illegal value has been supplied or an illegal value is used in a process-definition.</p>
</li>
<li>
<p><code>FlowableTaskAlreadyClaimedException</code>: Thrown when a task is already claimed, when the <code>taskService.claim(&#8230;&#8203;)</code> is called.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="queryAPI">3.3. Query API</h3>
<div class="paragraph">
<p>There are two ways of querying data from the engine: the query API and native queries. The Query API allows you to program completely typesafe queries with a fluent API. You can add various conditions to your queries (all of which are applied together as a logical AND) and precisely one ordering. The following code shows an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-n">tasks</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">taskAssignee</span><span class="tok-o">(</span><span class="tok-s">&quot;kermit&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">orderByDueDate</span><span class="tok-o">().</span><span class="tok-na">asc</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Sometimes you need more powerful queries, for example, queries using an OR operator or restrictions you cannot express using the Query API. For these cases, we have native queries, which allow you to write your own SQL queries. The return type is defined by the Query object you use and the data is mapped into the correct objects (Task, CaseInstance, &#8230;&#8203;). Since the query will be fired at the database you have to use table and column names as they are defined in the database; this requires some knowledge about the internal data structure and it is recommended to use native queries with care. The table names can be retrieved through the API to keep the dependency as small as possible.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-n">tasks</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createNativeTaskQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">sql</span><span class="tok-o">(</span><span class="tok-s">&quot;SELECT count(*) FROM &quot;</span> <span class="tok-o">+</span> <span class="tok-n">managementService</span><span class="tok-o">.</span><span class="tok-na">getTableName</span><span class="tok-o">(</span><span class="tok-n">Task</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span> <span class="tok-o">+</span>
      <span class="tok-s">&quot; T WHERE T.NAME_ = #{taskName}&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">parameter</span><span class="tok-o">(</span><span class="tok-s">&quot;taskName&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;gonzoTask&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>

<span class="tok-kt">long</span> <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createNativeTaskQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">sql</span><span class="tok-o">(</span><span class="tok-s">&quot;SELECT count(*) FROM &quot;</span> <span class="tok-o">+</span> <span class="tok-n">managementService</span><span class="tok-o">.</span><span class="tok-na">getTableName</span><span class="tok-o">(</span><span class="tok-n">Task</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-s">&quot; T1, &quot;</span> <span class="tok-o">+</span>
      <span class="tok-n">managementService</span><span class="tok-o">.</span><span class="tok-na">getTableName</span><span class="tok-o">(</span><span class="tok-n">VariableInstanceEntity</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-s">&quot; V1 WHERE V1.TASK_ID_ = T1.ID_&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">count</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="apiVariables">3.4. Variables</h3>
<div class="paragraph">
<p>Every case instance needs and uses data to execute the steps it&#8217;s made up of. In Flowable, this data is called <em>variables</em>, which are stored in the database. Variables can be used in expressions (for example, in a condition of a transition), in Java service tasks when calling external services (for example to provide the input or store the result of the service call), and so on.</p>
</div>
<div class="paragraph">
<p>A case instance can have variables (called <em>case variables</em>), but also <em>plan items</em> (which are enabled plan items) and human tasks can have variables. A case instance can have any number of variables. Each variable is stored in a row in the <em>ACT_RU_VARIABLE</em> database table.</p>
</div>
<div class="paragraph">
<p>The <em>createCaseInstanceBuilder</em> method has optional methods to provide the variables when the case instance is created and started. For example, from the <em>CmmnRuntimeService</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">CaseInstance</span> <span class="tok-n">caseInstance</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">createCaseInstanceBuilder</span><span class="tok-o">().</span><span class="tok-na">variable</span><span class="tok-o">(</span><span class="tok-s">&quot;var1&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;test&quot;</span><span class="tok-o">).</span><span class="tok-na">start</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Variables can be added during case execution. For example, (<em>CmmnRuntimeService</em>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-kt">void</span> <span class="tok-nf">setVariables</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">caseInstanceId</span><span class="tok-o">,</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-o">?</span> <span class="tok-kd">extends</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">variables</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Variables can also be retrieved, as shown below. Note that similar methods exist on the <em>CmmnTaskService</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-nf">getVariables</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">caseInstanceId</span><span class="tok-o">);</span>
<span class="tok-n">Object</span> <span class="tok-nf">getVariable</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">caseInstanceId</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Variables are often used in Java service tasks, expressions, scripts, and so on.</p>
</div>
</div>
<div class="sect2">
<h3 id="apiTransientVariables">3.5. Transient variables</h3>
<div class="paragraph">
<p>Transient variables are variables that behave like regular variables, but are not persisted. Typically, transient variables are used for advanced use cases.  When in doubt, use a regular case variable.</p>
</div>
<div class="paragraph">
<p>The following applies for transient variables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There is no history stored at all for transient variables.</p>
</li>
<li>
<p>Like <em>regular</em> variables, transient variables are put on the <em>highest parent</em> when set. This means that when setting a variable on an plan item, the transient variable is actually stored on the case instance execution. Like regular variables, a <em>local</em> variant of the method exists if the variable is set on the specific plan item or task.</p>
</li>
<li>
<p>A transient variable can only be accessed before the next <em>wait state</em> in the case definition. After that, they are gone. Here, the wait state means the point in the case instance where it is persisted to the data store.</p>
</li>
<li>
<p>Transient variables can only be set by the <em>setTransientVariable(name, value)</em>, but transient variables are also returned when calling <em>getVariable(name)</em> (a <em>getTransientVariable(name)</em> also exists, that only checks the transient variables). The reason for this is to make the writing of expressions easy and existing logic using variables works for both types.</p>
</li>
<li>
<p>A transient variable <em>shadows</em> a persistent variable with the same name. This means that when both a persistent and transient variable is set on a case instance and <em>getVariable("someVariable")</em> is called, the transient variable value will be returned.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can set and get transient variables in most places where regular variables are exposed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>On <em>DelegatePlanItemInstance</em> in <em>PlanItemJavaDelegate</em> implementations</p>
</li>
<li>
<p>When starting a case instance through the runtime service</p>
</li>
<li>
<p>When completing a task</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The methods follow the naming convention of the regular case variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">CaseInstance</span> <span class="tok-n">caseInstance</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">createCaseInstanceBuilder</span><span class="tok-o">().</span><span class="tok-na">transientVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;var1&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;test&quot;</span><span class="tok-o">).</span><span class="tok-na">start</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="apiExpressions">3.6. Expressions</h3>
<div class="paragraph">
<p>Flowable uses UEL for expression-resolving. UEL stands for <em>Unified Expression Language</em> and is part of the EE6 specification (see <a href="http://docs.oracle.com/javaee/6/tutorial/doc/gjddd.html"> the EE6 specification</a> for detailed information).</p>
</div>
<div class="paragraph">
<p>Expressions can be used in, for example, Java Service tasks, and plan item transitions. Although there are two types of expressions, value-expression and method-expression, Flowable abstracts this so they can both be used where an <code>expression</code> is expected.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Value expression</strong>: resolves to a value. By default, all case variables are available to use. Also, all spring-beans (if using Spring) are available to use in expressions. Some examples:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>${myVar}
${myBean.myProperty}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Method expression</strong>: invokes a method with or without parameters. <strong>When invoking a method without parameters, be sure to add empty parentheses after the method-name (as this distinguishes the expression from a value expression).</strong> The passed parameters can be literal values or expressions that are resolved themselves. Examples:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>${printer.print()}
${myBean.addNewOrder('orderName')}
${myBean.doSomething(myVar, execution)}</pre>
</div>
</div>
<div class="paragraph">
<p>Note that these expressions support resolving primitives (including comparing them), beans, lists, arrays and maps.</p>
</div>
<div class="paragraph">
<p>On top of all process variables, there are a few default objects available that can be used in expressions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>caseInstance</code>: The <code>DelegateCaseInstance</code> holds additional information about the ongoing case instance.</p>
</li>
<li>
<p><code>planItemInstance</code>: The <code>DelegatePlanItemInstance</code> holds additional information about the current plan item.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="apiUnitTesting">3.7. Unit testing</h3>
<div class="paragraph">
<p>Cases are an integral part of software projects and they should be tested in the same way normal application logic is tested: with unit tests. Since Flowable is an embeddable Java engine, writing unit tests for business processes is as simple as writing regular unit tests.</p>
</div>
<div class="paragraph">
<p>Flowable supports JUnit versions 4 styles of unit testing.</p>
</div>
<div class="paragraph">
<p>The CmmnTestRunner can be used to initialise the CMMN engine and with the FlowableCmmnTestCase test base class you can easily write unit tests against a running CMMN engine.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyBusinessProcessTest</span> <span class="tok-kd">extends</span> <span class="tok-n">FlowableCmmnTestCase</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Test</span>
  <span class="tok-nd">@CmmnDeployment</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">ruleUsageExample</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">CaseInstance</span> <span class="tok-n">caseInstance</span> <span class="tok-o">=</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">.</span><span class="tok-na">createCaseInstanceBuilder</span><span class="tok-o">()</span>
                    <span class="tok-o">.</span><span class="tok-na">caseDefinitionKey</span><span class="tok-o">(</span><span class="tok-s">&quot;myCase&quot;</span><span class="tok-o">)</span>
                    <span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
	<span class="tok-n">assertNotNull</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">);</span>

    <span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">=</span> <span class="tok-n">cmmnTaskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">caseInstanceId</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">()).</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Task 1&quot;</span><span class="tok-o">,</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;JohnDoe&quot;</span><span class="tok-o">,</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getAssignee</span><span class="tok-o">());</span>

    <span class="tok-n">cmmnTaskService</span><span class="tok-o">.</span><span class="tok-na">complete</span><span class="tok-o">(</span><span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">());</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">.</span><span class="tok-na">createCaseInstanceQuery</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">());</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="springintegration">4. Spring integration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>While you can definitely use Flowable without Spring, we&#8217;ve provided some very nice integration features that are explained in this chapter.</p>
</div>
<div class="sect2">
<h3 id="_cmmnenginefactorybean">4.1. CmmnEngineFactoryBean</h3>
<div class="paragraph">
<p>The <code>CmmnEngine</code> can be configured as a regular Spring bean. The starting point of the integration is the class <code>org.flowable.cmmn.spring.CmmnEngineFactoryBean</code>. That bean takes a CMMN engine configuration and creates the CMMN engine.  This means that the creation and configuration of properties for Spring is the same as documented in the <a href="#configuration">configuration section</a>. For Spring integration, the configuration and engine beans will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.spring.SpringCmmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    ...
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngine&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.spring.CmmnEngineFactoryBean&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>cmmnEngineConfiguration</code> bean now uses the <code>org.flowable.cmmn.spring.SpringCmmnEngineConfiguration</code> class.</p>
</div>
</div>
<div class="sect2">
<h3 id="_default_spring_configuration">4.2. Default Spring configuration</h3>
<div class="paragraph">
<p>The section shown below contains the dataSource, transactionManager, cmmnEngine and the Flowable engine services.</p>
</div>
<div class="paragraph">
<p>When passing the DataSource to the <code>SpringCmmnEngineConfiguration</code> (using property "dataSource"), Flowable uses a <code>org.springframework.jdbc.datasource.TransactionAwareDataSourceProxy</code> internally, which wraps the passed DataSource. This is done to make sure the SQL connections retrieved from the DataSource and the Spring transactions play well together. This implies that it&#8217;s no longer necessary to proxy the dataSource yourself in Spring configuration, although it&#8217;s still possible to pass a <code>TransactionAwareDataSourceProxy</code> into the <code>SpringCmmnEngineConfiguration</code>. In this case, no additional wrapping will occur.</p>
</div>
<div class="paragraph">
<p><strong>Make sure when declaring a <code>TransactionAwareDataSourceProxy</code> in Spring configuration yourself that you don&#8217;t use it for resources that are already aware of Spring transactions (e.g. DataSourceTransactionManager need the un-proxied dataSource).</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</div></td><td class="code"><span></span><span class="tok-nt">&lt;beans</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="tok-na">xmlns:context=</span><span class="tok-s">&quot;http://www.springframework.org/schema/context&quot;</span>
       <span class="tok-na">xmlns:tx=</span><span class="tok-s">&quot;http://www.springframework.org/schema/tx&quot;</span>
       <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="tok-na">xsi:schemaLocation=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans</span>
<span class="tok-s">                             http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="tok-s">                           http://www.springframework.org/schema/context</span>
<span class="tok-s">                             http://www.springframework.org/schema/context/spring-context-2.5.xsd</span>
<span class="tok-s">                           http://www.springframework.org/schema/tx</span>
<span class="tok-s">                             http://www.springframework.org/schema/tx/spring-tx-3.0.xsd&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.springframework.jdbc.datasource.SimpleDriverDataSource&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;driverClass&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;org.h2.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;url&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:h2:mem:flowable;DB_CLOSE_DELAY=1000&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;username&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;sa&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;password&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.spring.SpringCmmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseSchemaUpdate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngine&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.spring.CmmnEngineFactoryBean&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnRepositoryService&quot;</span> <span class="tok-na">factory-bean=</span><span class="tok-s">&quot;cmmnEngine&quot;</span> <span class="tok-na">factory-method=</span><span class="tok-s">&quot;getCmmnRepositoryService&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnRuntimeService&quot;</span> <span class="tok-na">factory-bean=</span><span class="tok-s">&quot;cmmnEngine&quot;</span> <span class="tok-na">factory-method=</span><span class="tok-s">&quot;getCmmnRuntimeService&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnTaskService&quot;</span> <span class="tok-na">factory-bean=</span><span class="tok-s">&quot;cmmnEngine&quot;</span> <span class="tok-na">factory-method=</span><span class="tok-s">&quot;getCmmnTaskService&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnHistoryService&quot;</span> <span class="tok-na">factory-bean=</span><span class="tok-s">&quot;cmmnEngine&quot;</span> <span class="tok-na">factory-method=</span><span class="tok-s">&quot;getCmmnHistoryService&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnManagementService&quot;</span> <span class="tok-na">factory-bean=</span><span class="tok-s">&quot;cmmnEngine&quot;</span> <span class="tok-na">factory-method=</span><span class="tok-s">&quot;getCmmnManagementService&quot;</span> <span class="tok-nt">/&gt;</span>

...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>First, the application context is created using any of the ways supported by Spring. In this example, you could use a classpath XML resource to configure our Spring application context:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-n">ClassPathXmlApplicationContext</span> <span class="tok-n">applicationContext</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ClassPathXmlApplicationContext</span><span class="tok-o">(</span>
	<span class="tok-s">&quot;org/flowable/cmmn/examples/spring/SpringIntegrationTest-context.xml&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>or, as it&#8217;s a test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-nd">@ContextConfiguration</span><span class="tok-o">(</span>
  <span class="tok-s">&quot;classpath:org/flowable/cmmn/spring/test/SpringIntegrationTest-context.xml&quot;</span><span class="tok-o">)</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="springExpressions">4.3. Expressions</h3>
<div class="paragraph">
<p>When using the CmmnEngineFactoryBean, all expressions in the CMMN processes will also <em>see</em> all the Spring beans, by default. It&#8217;s possible to limit the beans (even none) you want to expose in expressions using a map that you can configure.  The example below exposes a single bean (printer), available to use under the key "printer".  <strong>To have NO beans exposed at all, just pass an empty list as <em>beans</em> property on the SpringCmmnEngineConfiguration. When no <em>beans</em> property is set, all Spring beans in the context will be available.</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.spring.SpringCmmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
  ...
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;beans&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;map&gt;</span>
      <span class="tok-nt">&lt;entry</span> <span class="tok-na">key=</span><span class="tok-s">&quot;printer&quot;</span> <span class="tok-na">value-ref=</span><span class="tok-s">&quot;printer&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/map&gt;</span>
  <span class="tok-nt">&lt;/property&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;printer&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.examples.spring.Printer&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the exposed beans can be used in expressions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span>...
	<span class="tok-nt">&lt;case</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myCase&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;casePlanModel</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myPlanModel&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My CasePlanModel&quot;</span><span class="tok-nt">&gt;</span>

            <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem1&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Task One&quot;</span> <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;serviceTask&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem2&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;The Case&quot;</span> <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;task&quot;</span><span class="tok-nt">&gt;</span>
                <span class="tok-nt">&lt;entryCriterion</span> <span class="tok-na">sentryRef=</span><span class="tok-s">&quot;sentry1&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;/planItem&gt;</span>

            <span class="tok-nt">&lt;sentry</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentry1&quot;</span><span class="tok-nt">&gt;</span>
                <span class="tok-nt">&lt;planItemOnPart</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;planItem1&quot;</span><span class="tok-nt">&gt;</span>
                    <span class="tok-nt">&lt;standardEvent&gt;</span>complete<span class="tok-nt">&lt;/standardEvent&gt;</span>
                <span class="tok-nt">&lt;/planItemOnPart&gt;</span>
            <span class="tok-nt">&lt;/sentry&gt;</span>

            <span class="tok-nt">&lt;task</span> <span class="tok-na">id=</span><span class="tok-s">&quot;serviceTask&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;java&quot;</span> <span class="tok-na">flowable:expression=</span><span class="tok-s">&quot;${printer.printMessage(var1)}&quot;</span> <span class="tok-na">flowable:resultVariableName=</span><span class="tok-s">&quot;customResponse&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;task</span> <span class="tok-na">id=</span><span class="tok-s">&quot;task&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;The Task&quot;</span> <span class="tok-na">isBlocking=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>

        <span class="tok-nt">&lt;/casePlanModel&gt;</span>
    <span class="tok-nt">&lt;/case&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>Printer</code> looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Printer</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">printMessage</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">var</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;hello &quot;</span> <span class="tok-o">+</span> <span class="tok-n">var</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>And the Spring bean configuration (also shown above) looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;beans&gt;</span>
  ...

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;printer&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.examples.spring.Printer&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;/beans&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_automatic_resource_deployment">4.4. Automatic resource deployment</h3>
<div class="paragraph">
<p>Spring integration also has a special feature for deploying resources.  In the CMMN engine configuration, you can specify a set of resources. When the CMMN engine is created, all those resources will be scanned and deployed.  There is filtering in place that prevents duplicate deployments.  Only when the resources have actually changed will new deployments be deployed to the Flowable DB. This makes sense in a lot of use cases, where the Spring container is rebooted frequently (for example, testing).</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.spring.SpringCmmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
  ...
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;deploymentResources&quot;</span>
    <span class="tok-na">value=</span><span class="tok-s">&quot;classpath*:/org/flowable/cmmn/spring/test/autodeployment/autodeploy.*.cmmn&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngine&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.spring.CmmnEngineFactoryBean&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the configuration above will group all of the resources matching the filter into a single deployment to the Flowable engine. The duplicate filtering to prevent re-deployment of unchanged resources applies to the whole deployment. In some cases, this may not be what you want. For instance, if you deploy a set of process resources this way and only a single case definition in those resources has changed, the deployment as a whole will be considered new and all of the case definitions in that deployment will be re-deployed, resulting in new  versions of each of the case definitions, even though only one was actually changed.</p>
</div>
<div class="paragraph">
<p>To be able to customize the way deployments are determined, you can specify an additional property in the <code>SpringCmmnEngineConfiguration</code>, <code>deploymentMode</code>. This property defines the way deployments will be determined from the set of resources that match the filter. There are 3 values that are supported by default for this property:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>default</code>: Group all resources into a single deployment and apply duplicate filtering to that deployment. This is the default value and it will be used if you don&#8217;t specify a value.</p>
</li>
<li>
<p><code>single-resource</code>: Create a separate deployment for each individual resource and apply duplicate filtering to that deployment. This is the value you would use to have each process definition be deployed separately and only create a new case definition version if it has changed.</p>
</li>
<li>
<p><code>resource-parent-folder</code>: Create a separate deployment for resources that share the same parent folder and apply duplicate filtering to that deployment. This value can be used to create separate deployments for most resources, but still be able to group some by placing them in a shared folder. Here&#8217;s an example of how to specify the <code>single-resource</code> configuration for <code>deploymentMode</code>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span>
    <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.spring.SpringCmmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
  ...
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;deploymentResources&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;classpath*:/flowable/*.cmmn&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;deploymentMode&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;single-resource&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to using the values listed above for <code>deploymentMode</code>, you may require customized behavior towards determining deployments. If so, you can create a subclass of <code>SpringCmmnEngineConfiguration</code> and override the <code>getAutoDeploymentStrategy(String deploymentMode)</code> method.  This method determines which deployment strategy is used for a certain value of the <code>deploymentMode</code> configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="springUnitTest">4.5. Unit testing</h3>
<div class="paragraph">
<p>When integrating with Spring, business processes can be tested very easily using the standard Flowable testing facilities. The following example shows how a case definition is tested in a typical Spring-based unit test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyBusinessProcessTest</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Rule</span>
  <span class="tok-kd">public</span> <span class="tok-n">FlowableCmmnRule</span> <span class="tok-n">cmmnRule</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">FlowableCmmnRule</span><span class="tok-o">(</span><span class="tok-s">&quot;org/flowable/spring/test/el/SpringBeanTest-context.xml&quot;</span><span class="tok-o">);</span>

  <span class="tok-nd">@Test</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">simpleCaseTest</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">cmmnRule</span><span class="tok-o">.</span><span class="tok-na">getCmmnRepositoryService</span><span class="tok-o">().</span><span class="tok-na">createDeployment</span><span class="tok-o">().</span><span class="tok-na">addClasspathResource</span><span class="tok-o">(</span><span class="tok-s">&quot;org/flowable/spring/test/el/springExpression.cmmn&quot;</span><span class="tok-o">).</span><span class="tok-na">deploy</span><span class="tok-o">();</span>
    <span class="tok-n">CmmnRuntimeService</span> <span class="tok-n">cmmnRuntimeService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnRule</span><span class="tok-o">.</span><span class="tok-na">getCmmnRuntimeService</span><span class="tok-o">();</span>
    <span class="tok-n">CaseInstance</span> <span class="tok-n">caseInstance</span> <span class="tok-o">=</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">.</span><span class="tok-na">createCaseInstanceBuilder</span><span class="tok-o">()</span>
    		<span class="tok-o">.</span><span class="tok-na">caseDefinitionKey</span><span class="tok-o">(</span><span class="tok-s">&quot;myCase&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">variable</span><span class="tok-o">(</span><span class="tok-s">&quot;var1&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;John Doe&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>

	<span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertNotNull</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chDeployment">5. Deployment</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_external_resources">5.1. External resources</h3>
<div class="paragraph">
<p>Case definitions live in the Flowable database. These case definitions can reference delegation classes when using Service Tasks or Spring beans from the Flowable configuration file. These classes and the Spring configuration file have to be available to all CMMN engines that may execute the case definitions.</p>
</div>
<div class="sect3">
<h4 id="_java_classes">5.1.1. Java classes</h4>
<div class="paragraph">
<p>All custom classes that are used in your case definition (for example, PlanItemJavaDelegates used in Service Tasks) should be present on the engine&#8217;s classpath when an instance of the case is started.</p>
</div>
<div class="paragraph">
<p>During deployment of a case definition however, those classes don&#8217;t have to be present on the classpath. This means that your delegation classes don&#8217;t have to be on the classpath when deploying a new case definition, for example.</p>
</div>
<div class="paragraph">
<p>When you are using the demo setup and you want to add your custom classes, you should add a JAR containing your classes to the flowable-task or flowable-rest webapp lib. Don&#8217;t forget to include the dependencies of your custom classes (if any) as well. Alternatively, you can include your dependencies in the libraries directory of your Tomcat installation, <code>${tomcat.home}/lib</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_spring_beans_from_a_process">5.1.2. Using Spring beans from a process</h4>
<div class="paragraph">
<p>When expressions or scripts use Spring beans, those beans have to be available to the engine when executing the process definition. If you are building your own webapp and you configure your CMMN engine in your context as described in <a href="#springintegration">the spring integration section</a>, that is straightforward. But bear in mind that you also should update the Flowable task and rest webapps with that context if you use it.</p>
</div>
</div>
<div class="sect3">
<h4 id="_creating_a_single_app">5.1.3. Creating a single app</h4>
<div class="paragraph">
<p>Instead of making sure that all CMMN engines have all the delegation classes on their classpath and use the right Spring configuration, you may consider including the Flowable REST webapp inside your own webapp so that there is only a single <code>CmmnEngine</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="versioningOfCaseDefinitions">5.2. Versioning of case definitions</h3>
<div class="paragraph">
<p>CMMN doesn&#8217;t have a notion of versioning.  That is actually good, because the executable CMMN file will probably live in a version control system repository (such as Subversion, Git or Mercurial) as part of your development project.  However, versions of case definitions are created in the engine as part of deployment. During deployment, Flowable will assign a version to the <code>CaseDefinition</code> before it is stored in the Flowable DB.</p>
</div>
<div class="paragraph">
<p>For each case definition in a deployment, the following steps are performed to initialize the properties <code>key</code>, <code>version</code>, <code>name</code> and <code>id</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The case definition <code>id</code> attribute in the XML file is used as the case definition <code>key</code> property.</p>
</li>
<li>
<p>The case definition <code>name</code> attribute in the XML file is used as the case definition <code>name</code> property. If the name attribute is not specified, then the id attribute is used as the name.</p>
</li>
<li>
<p>The first time a case with a particular key is deployed, version 1 is assigned.  For all subsequent deployments of case definitions with the same key, the version will be set 1 higher than the highest currently deployed version. The key property is used to distinguish case definitions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Take for example the following case</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;definitions</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myDefinitions&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;case</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myCase&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My important case&quot;</span> <span class="tok-nt">&gt;</span>
    ...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>When deploying this case definition, the case definition in the database will look like this:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">key</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">676</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myCase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Suppose we now deploy an updated version of the same case (for example, changing some human tasks), but the <code>id</code> of the case definition remains the same. The case definition table will now contain the following entries:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">key</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">676</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myCase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">870</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myCase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When the <code>runtimeService.createCaseInstanceBuilder().caseDefinitionKey("myCase").start()</code> is called, it will now use the case definition with version <code>2</code>, as this is the latest version of the case definition.</p>
</div>
<div class="paragraph">
<p>Should we create a second case, as defined below and deploy this to Flowable, a third row will be added to the table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;definitions</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myNewDefinitions&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;case</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myNewCase&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My important case&quot;</span> <span class="tok-nt">&gt;</span>
    ...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The table will look like this:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">key</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">676</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myCase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">870</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myCase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1033</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myNewCase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note how the key for the new case is different from our first case. Even though the name is the same (we should probably have changed that too), Flowable only considers the <code>id</code> attribute when distinguishing cases. The new case is therefore deployed with version 1.</p>
</div>
</div>
<div class="sect2">
<h3 id="deploymentCategory">5.3. Category</h3>
<div class="paragraph">
<p>Both deployments and case definitions have user-defined categories.  The case definition category is initialized with the value of the targetNamespace attribute in the CMMN XML: <code>&lt;definitions &#8230;&#8203; targetNamespace="yourCategory" &#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>The deployment category can also be specified in the API like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">repositoryService</span>
    <span class="tok-o">.</span><span class="tok-na">createDeployment</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">category</span><span class="tok-o">(</span><span class="tok-s">&quot;yourCategory&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">...</span>
    <span class="tok-o">.</span><span class="tok-na">deploy</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cmmn_1_1">6. CMMN 1.1</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_is_cmmn">6.1. What is CMMN?</h3>
<div class="paragraph">
<p>The Case Management Model and Notation (CMMN) is a standard notation and formal specification by the <a href="http://www.omg.org/spec/CMMN/">Object Management Group</a> for representing case models.</p>
</div>
<div class="paragraph">
<p>Flowable contains:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A CMMN 1.1 modeler to create CMMN 1.1 case models</p>
</li>
<li>
<p>A Java engine that can import and execute CMMN 1.1 case models</p>
</li>
<li>
<p>A demonstration UI that executes the case models, allowing users to see and complete human tasks (and their forms)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_basic_concepts_and_terminology">6.2. Basic concepts and terminology</h3>
<div class="paragraph">
<p>The following figure shows a simple CMMN 1.1 diagram:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn-basic-concepts.png" alt="cmmn basic concepts">
</div>
</div>
<div class="paragraph">
<p>A <strong>case model</strong> is always visualized as some sort of <em>folder</em> that contains all the case elements. Every case model contains a <strong>plan model</strong> onto which items will be <em>planned</em>.</p>
</div>
<div class="paragraph">
<p>The elements of a plan model are called <strong>plan items</strong>. Each <em>plan item</em> has a <strong>plan item definition</strong> that gives its type and possible configuration options at runtime. For example, in the figure above, there are three <strong>human task</strong> plan items and one <strong>milestone</strong>. Other examples of plan items are <em>process tasks, case tasks and stages</em>.</p>
</div>
<div class="paragraph">
<p>After having deployed a case model to the Flowable CMMN engine, it&#8217;s possible to start <strong>case instances</strong> based on this case model. The plan items defined in the case model similarly have <strong>plan item instance</strong> runtime representations that are exposed by, and can be queried using, the Flowable API.</p>
</div>
<div class="paragraph">
<p>Plan items can have <em>sentries</em>: a plan item is said to have <em>entry criteria</em> when a sentry "guards" its activation. These criteria specify conditions that must be satisfied to <em>trigger the sentry</em>. For example, in the figure above, the "Milestone One" plan item is <em>available</em> after a case instance is started, but it is <em>activated</em> (in CMMN 1.1 specification terminology: it moves from the <em>available</em> state to the <em>active</em> state) when both human task A and B are completed. Note that sentries can have complex expression in their <em>if part</em>, which are not visualized, allowing for much more complex functionality. Also note that there can be multiple sentries, although only one needs to be satisfied to trigger a state transition.</p>
</div>
<div class="paragraph">
<p>Plan items and the plan model can also have sentries with <em>exit criteria</em>, which specify conditions that trigger an <em>exit</em> from that particular plan item. In the figure above, the whole plan model is exited (as are all the child elements that are active at that moment), when human task C completes.</p>
</div>
<div class="paragraph">
<p>CMMN 1.1 defines a standard XML format in an XSD that is part of the specification. For information, the example in the figure above is represented in XML as shown below.</p>
</div>
<div class="paragraph">
<p>Some observations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The four plan items above are in the XML and they reference their definition with a <em>definitionRef</em>. The actual definitions are at the bottom of the <em>casePlanModel</em> element</p>
</li>
<li>
<p>The plan items have criteria (entry or exit) that reference a <em>sentry</em> (not the other way around)</p>
</li>
<li>
<p>The XML also contains information on how the diagram is visualized (x and y coordinates, widths and heights, and so on), which are omitted below. These elements are important when exchanging case models with other CMMN 1.1 modeling tools to preserve the correct visual representation</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52</div></td><td class="code"><span></span><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tok-nt">&lt;definitions</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.omg.org/spec/CMMN/20151109/MODEL&quot;</span>
             <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
             <span class="tok-na">xmlns:flowable=</span><span class="tok-s">&quot;http://flowable.org/cmmn&quot;</span>
             <span class="tok-na">xmlns:cmmndi=</span><span class="tok-s">&quot;http://www.omg.org/spec/CMMN/20151109/CMMNDI&quot;</span>
             <span class="tok-na">xmlns:dc=</span><span class="tok-s">&quot;http://www.omg.org/spec/CMMN/20151109/DC&quot;</span>
             <span class="tok-na">xmlns:di=</span><span class="tok-s">&quot;http://www.omg.org/spec/CMMN/20151109/DI&quot;</span>
             <span class="tok-na">targetNamespace=</span><span class="tok-s">&quot;http://www.flowable.org/casedef&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;case</span> <span class="tok-na">id=</span><span class="tok-s">&quot;simpleExample&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Simple Example&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;casePlanModel</span> <span class="tok-na">id=</span><span class="tok-s">&quot;casePlanModel&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My Case&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem1&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Human task A&quot;</span>
            <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;sid-88199E7C-7655-439C-810B-8849FC52D3EB&quot;</span><span class="tok-nt">&gt;&lt;/planItem&gt;</span>
      <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem2&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Milestone One&quot;</span>
            <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;sid-8BF8A774-A8A7-4F1A-95CF-1E0D61EE5A47&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;entryCriterion</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-62CC4A6D-B29B-4129-93EA-460253C45CDF&quot;</span>
            <span class="tok-na">sentryRef=</span><span class="tok-s">&quot;sentry1&quot;</span><span class="tok-nt">&gt;&lt;/entryCriterion&gt;</span>
      <span class="tok-nt">&lt;/planItem&gt;</span>
      <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem3&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Human task B&quot;</span>
            <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;sid-A1FB8733-0DBC-4B38-9830-CBC4D0C4B802&quot;</span><span class="tok-nt">&gt;&lt;/planItem&gt;</span>
      <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem4&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Human task C&quot;</span>
            <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;sid-D3970AFC-7391-4BA7-95BA-51C64D2F41E9&quot;</span><span class="tok-nt">&gt;&lt;/planItem&gt;</span>
      <span class="tok-nt">&lt;sentry</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentry1&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;planItemOnPart</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentryOnPart1&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;planItem1&quot;</span><span class="tok-nt">&gt;</span>
          <span class="tok-nt">&lt;standardEvent&gt;</span>complete<span class="tok-nt">&lt;/standardEvent&gt;</span>
        <span class="tok-nt">&lt;/planItemOnPart&gt;</span>
        <span class="tok-nt">&lt;planItemOnPart</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentryOnPart2&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;planItem3&quot;</span><span class="tok-nt">&gt;</span>
          <span class="tok-nt">&lt;standardEvent&gt;</span>complete<span class="tok-nt">&lt;/standardEvent&gt;</span>
        <span class="tok-nt">&lt;/planItemOnPart&gt;</span>
      <span class="tok-nt">&lt;/sentry&gt;</span>
      <span class="tok-nt">&lt;sentry</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentry2&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;planItemOnPart</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentryOnPart3&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;planItem4&quot;</span><span class="tok-nt">&gt;</span>
          <span class="tok-nt">&lt;standardEvent&gt;</span>complete<span class="tok-nt">&lt;/standardEvent&gt;</span>
        <span class="tok-nt">&lt;/planItemOnPart&gt;</span>
      <span class="tok-nt">&lt;/sentry&gt;</span>
      <span class="tok-nt">&lt;humanTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-88199E7C-7655-439C-810B-8849FC52D3EB&quot;</span>
        <span class="tok-na">name=</span><span class="tok-s">&quot;Human task A&quot;</span><span class="tok-nt">&gt;&lt;/humanTask&gt;</span>
      <span class="tok-nt">&lt;milestone</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-8BF8A774-A8A7-4F1A-95CF-1E0D61EE5A47&quot;</span>
        <span class="tok-na">name=</span><span class="tok-s">&quot;Milestone One&quot;</span><span class="tok-nt">&gt;&lt;/milestone&gt;</span>
      <span class="tok-nt">&lt;humanTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-A1FB8733-0DBC-4B38-9830-CBC4D0C4B802&quot;</span>
        <span class="tok-na">name=</span><span class="tok-s">&quot;Human task B&quot;</span><span class="tok-nt">&gt;&lt;/humanTask&gt;</span>
      <span class="tok-nt">&lt;humanTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-D3970AFC-7391-4BA7-95BA-51C64D2F41E9&quot;</span>
        <span class="tok-na">name=</span><span class="tok-s">&quot;Human task C&quot;</span><span class="tok-nt">&gt;&lt;/humanTask&gt;</span>
      <span class="tok-nt">&lt;exitCriterion</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-422626DB-9B40-49D8-955E-641AB96A5BFA&quot;</span>
        <span class="tok-na">sentryRef=</span><span class="tok-s">&quot;sentry2&quot;</span><span class="tok-nt">&gt;&lt;/exitCriterion&gt;</span>
    <span class="tok-nt">&lt;/casePlanModel&gt;</span>
  <span class="tok-nt">&lt;/case&gt;</span>
  <span class="tok-nt">&lt;cmmndi:CMMNDI&gt;</span>
    <span class="tok-nt">&lt;cmmndi:CMMNDiagram</span> <span class="tok-na">id=</span><span class="tok-s">&quot;CMMNDiagram_simpleExample&quot;</span><span class="tok-nt">&gt;</span>
        ...
    <span class="tok-nt">&lt;/cmmndi:CMMNDiagram&gt;</span>
  <span class="tok-nt">&lt;/cmmndi:CMMNDI&gt;</span>
<span class="tok-nt">&lt;/definitions&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_programmatic_example">6.3. Programmatic example</h3>
<div class="paragraph">
<p>In this section we&#8217;re going to build a simple case model and execute it programmatically through the Java API&#8217;s of the Flowable CMMN engine in a simple command line example.</p>
</div>
<div class="paragraph">
<p>The case model we&#8217;ll build is a (simplified) <em>employee onboarding</em> case with two stages: a phase before and phase after the potential employee has started. In the first stage, someone from the HR department will complete the tasks, while in the second stage it is the employee completing them. Also, at any point in time, the potential employee can reject the job and stop the whole case instance.</p>
</div>
<div class="paragraph">
<p>Note that only stages and human tasks are used. In a real case model, there will most likely other plan item types too, like milestones, nested stages, automated tasks, etc.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.programmatic.example.png" alt="cmmn.programmatic.example">
</div>
</div>
<div class="paragraph">
<p>The XML for this case models is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85</div></td><td class="code"><span></span><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tok-nt">&lt;definitions</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.omg.org/spec/CMMN/20151109/MODEL&quot;</span>
             <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
             <span class="tok-na">xmlns:flowable=</span><span class="tok-s">&quot;http://flowable.org/cmmn&quot;</span>
             <span class="tok-na">xmlns:cmmndi=</span><span class="tok-s">&quot;http://www.omg.org/spec/CMMN/20151109/CMMNDI&quot;</span>
             <span class="tok-na">xmlns:dc=</span><span class="tok-s">&quot;http://www.omg.org/spec/CMMN/20151109/DC&quot;</span>
             <span class="tok-na">xmlns:di=</span><span class="tok-s">&quot;http://www.omg.org/spec/CMMN/20151109/DI&quot;</span>
             <span class="tok-na">targetNamespace=</span><span class="tok-s">&quot;http://www.flowable.org/casedef&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;case</span> <span class="tok-na">id=</span><span class="tok-s">&quot;employeeOnboarding&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Simple Example&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;casePlanModel</span> <span class="tok-na">id=</span><span class="tok-s">&quot;casePlanModel&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My Case&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem5&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Prior to starting&quot;</span>
            <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;sid-025D29E8-BA9B-403D-A684-8C5B52185642&quot;</span><span class="tok-nt">&gt;&lt;/planItem&gt;</span>
      <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem8&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;After starting&quot;</span>
            <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;sid-8459EF32-4F4C-4E9B-A6E9-87FDC2299044&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;entryCriterion</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-50B5F12D-FE75-4D05-9148-86574EE6C073&quot;</span>
            <span class="tok-na">sentryRef=</span><span class="tok-s">&quot;sentry2&quot;</span><span class="tok-nt">&gt;&lt;/entryCriterion&gt;</span>
      <span class="tok-nt">&lt;/planItem&gt;</span>
      <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem9&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Reject job&quot;</span>
            <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;sid-134E885A-3D58-417E-81E2-66A3E12334F9&quot;</span><span class="tok-nt">&gt;&lt;/planItem&gt;</span>
      <span class="tok-nt">&lt;sentry</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentry2&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;planItemOnPart</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentryOnPart4&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;planItem5&quot;</span><span class="tok-nt">&gt;</span>
          <span class="tok-nt">&lt;standardEvent&gt;</span>complete<span class="tok-nt">&lt;/standardEvent&gt;</span>
        <span class="tok-nt">&lt;/planItemOnPart&gt;</span>
      <span class="tok-nt">&lt;/sentry&gt;</span>
      <span class="tok-nt">&lt;sentry</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentry3&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;planItemOnPart</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentryOnPart5&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;planItem9&quot;</span><span class="tok-nt">&gt;</span>
          <span class="tok-nt">&lt;standardEvent&gt;</span>complete<span class="tok-nt">&lt;/standardEvent&gt;</span>
        <span class="tok-nt">&lt;/planItemOnPart&gt;</span>
      <span class="tok-nt">&lt;/sentry&gt;</span>
      <span class="tok-nt">&lt;stage</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-025D29E8-BA9B-403D-A684-8C5B52185642&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Prior to starting&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem1&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Create email address&quot;</span>
                <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;sid-EA434DDD-E1BE-4AC1-8520-B19ACE8782D2&quot;</span><span class="tok-nt">&gt;&lt;/planItem&gt;</span>
        <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem2&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Allocate office&quot;</span>
                <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;sid-505BA223-131A-4EF0-ABAD-485AEB0F2C96&quot;</span><span class="tok-nt">&gt;&lt;/planItem&gt;</span>
        <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem3&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Send joining letter to candidate&quot;</span>
                <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;sid-D28DBAD5-0F5F-45F4-8553-3381199AC45F&quot;</span><span class="tok-nt">&gt;</span>
          <span class="tok-nt">&lt;entryCriterion</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-4D88C79D-8E31-4246-9541-A4F6A5720AC8&quot;</span>
            <span class="tok-na">sentryRef=</span><span class="tok-s">&quot;sentry1&quot;</span><span class="tok-nt">&gt;&lt;/entryCriterion&gt;</span>
        <span class="tok-nt">&lt;/planItem&gt;</span>
        <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem4&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Agree start date&quot;</span>
                <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;sid-97A72C46-C0AD-477F-86DD-85EF643BB97D&quot;</span><span class="tok-nt">&gt;&lt;/planItem&gt;</span>
        <span class="tok-nt">&lt;sentry</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentry1&quot;</span><span class="tok-nt">&gt;</span>
          <span class="tok-nt">&lt;planItemOnPart</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentryOnPart1&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;planItem1&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;standardEvent&gt;</span>complete<span class="tok-nt">&lt;/standardEvent&gt;</span>
          <span class="tok-nt">&lt;/planItemOnPart&gt;</span>
          <span class="tok-nt">&lt;planItemOnPart</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentryOnPart2&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;planItem2&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;standardEvent&gt;</span>complete<span class="tok-nt">&lt;/standardEvent&gt;</span>
          <span class="tok-nt">&lt;/planItemOnPart&gt;</span>
          <span class="tok-nt">&lt;planItemOnPart</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentryOnPart3&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;planItem4&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;standardEvent&gt;</span>complete<span class="tok-nt">&lt;/standardEvent&gt;</span>
          <span class="tok-nt">&lt;/planItemOnPart&gt;</span>
        <span class="tok-nt">&lt;/sentry&gt;</span>
        <span class="tok-nt">&lt;humanTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-EA434DDD-E1BE-4AC1-8520-B19ACE8782D2&quot;</span>
            <span class="tok-na">name=</span><span class="tok-s">&quot;Create email address&quot;</span>
            <span class="tok-na">flowable:candidateGroups=</span><span class="tok-s">&quot;hr&quot;</span><span class="tok-nt">&gt;&lt;/humanTask&gt;</span>
        <span class="tok-nt">&lt;humanTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-505BA223-131A-4EF0-ABAD-485AEB0F2C96&quot;</span>
            <span class="tok-na">name=</span><span class="tok-s">&quot;Allocate office&quot;</span>
            <span class="tok-na">flowable:candidateGroups=</span><span class="tok-s">&quot;hr&quot;</span><span class="tok-nt">&gt;&lt;/humanTask&gt;</span>
        <span class="tok-nt">&lt;humanTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-D28DBAD5-0F5F-45F4-8553-3381199AC45F&quot;</span>
            <span class="tok-na">name=</span><span class="tok-s">&quot;Send joining letter to candidate&quot;</span>
            <span class="tok-na">flowable:candidateGroups=</span><span class="tok-s">&quot;hr&quot;</span><span class="tok-nt">&gt;&lt;/humanTask&gt;</span>
        <span class="tok-nt">&lt;humanTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-97A72C46-C0AD-477F-86DD-85EF643BB97D&quot;</span>
            <span class="tok-na">name=</span><span class="tok-s">&quot;Agree start date&quot;</span>
            <span class="tok-na">flowable:candidateGroups=</span><span class="tok-s">&quot;hr&quot;</span><span class="tok-nt">&gt;&lt;/humanTask&gt;</span>
      <span class="tok-nt">&lt;/stage&gt;</span>
      <span class="tok-nt">&lt;stage</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-8459EF32-4F4C-4E9B-A6E9-87FDC2299044&quot;</span>
        <span class="tok-na">name=</span><span class="tok-s">&quot;After starting&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem6&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;New starter training&quot;</span>
                <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;sid-DF7B9582-11A6-40B4-B7E5-EC7AC6029387&quot;</span><span class="tok-nt">&gt;&lt;/planItem&gt;</span>
        <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem7&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Fill in paperwork&quot;</span>
                <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;sid-7BF2B421-7FA0-479D-A8BD-C22EBD09F599&quot;</span><span class="tok-nt">&gt;&lt;/planItem&gt;</span>
        <span class="tok-nt">&lt;humanTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-DF7B9582-11A6-40B4-B7E5-EC7AC6029387&quot;</span>
            <span class="tok-na">name=</span><span class="tok-s">&quot;New starter training&quot;</span>
            <span class="tok-na">flowable:assignee=</span><span class="tok-s">&quot;${potentialEmployee}&quot;</span><span class="tok-nt">&gt;&lt;/humanTask&gt;</span>
        <span class="tok-nt">&lt;humanTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-7BF2B421-7FA0-479D-A8BD-C22EBD09F599&quot;</span>
            <span class="tok-na">name=</span><span class="tok-s">&quot;Fill in paperwork&quot;</span>
            <span class="tok-na">flowable:assignee=</span><span class="tok-s">&quot;${potentialEmployee}&quot;</span><span class="tok-nt">&gt;&lt;/humanTask&gt;</span>
      <span class="tok-nt">&lt;/stage&gt;</span>
      <span class="tok-nt">&lt;humanTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-134E885A-3D58-417E-81E2-66A3E12334F9&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Reject job&quot;</span>
        <span class="tok-na">flowable:assignee=</span><span class="tok-s">&quot;${potentialEmployee}&quot;</span><span class="tok-nt">&gt;&lt;/humanTask&gt;</span>
      <span class="tok-nt">&lt;exitCriterion</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-18277F30-E146-4B3E-B3C9-3F1E187EC7A8&quot;</span>
        <span class="tok-na">sentryRef=</span><span class="tok-s">&quot;sentry3&quot;</span><span class="tok-nt">&gt;&lt;/exitCriterion&gt;</span>
    <span class="tok-nt">&lt;/casePlanModel&gt;</span>
  <span class="tok-nt">&lt;/case&gt;</span>
<span class="tok-nt">&lt;/definitions&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>First of all, create a new project and add the <em>flowable-cmmn-engine</em> dependency (here shown for Maven). The H2 dependency is also added, as H2 will be used as embedded database later on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>org.flowable<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>flowable-cmmn-engine<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>${flowable.version}<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
<span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>com.h2database<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>h2<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>${h2.version}<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Flowable CMMN API is designed to be consistent with the other Flowable API&#8217;s and concepts. As such, people that know the BPMN or DMN API&#8217;s will have no problem finding their way around. As with the other engines, the first line of code is creating a CmmnEngine. Here, the default in-memory configuration is used, which uses H2 as database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Main</span> <span class="tok-o">{</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">CmmnEngine</span> <span class="tok-n">cmmnEngine</span>
        <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">StandaloneInMemCmmnEngineConfiguration</span><span class="tok-o">().</span><span class="tok-na">buildCmmnEngine</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <em>CmmnEngineConfiguration</em> exposes many configuration options for tweaking various settings of the CMMN engine.</p>
</div>
<div class="paragraph">
<p>Put the XML from above in a file, for example <em>my-case.cmmn</em> (or .cmmn.xml). For Maven, it should be placed in the <em>src/main/resources</em> folder.</p>
</div>
<div class="paragraph">
<p>To make the engine aware of the case model, it needs to be <em>deployed</em> first. This is done through the <em>CmmnRepositoryService</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">CmmnRepositoryService</span> <span class="tok-n">cmmnRepositoryService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnRepositoryService</span><span class="tok-o">();</span>
<span class="tok-n">CmmnDeployment</span> <span class="tok-n">cmmnDeployment</span> <span class="tok-o">=</span> <span class="tok-n">cmmnRepositoryService</span><span class="tok-o">.</span><span class="tok-na">createDeployment</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">addClasspathResource</span><span class="tok-o">(</span><span class="tok-s">&quot;my-case.cmmn&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">deploy</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Deploying the XML will return a <strong>CmmnDeployment</strong>. A deployment can contain many case models and artifacts. The specific case model definition of above is stored as a <strong>CaseDefinition</strong>. This can be verified by doing a <em>CaseDefinitionQuery</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">CaseDefinition</span><span class="tok-o">&gt;</span> <span class="tok-n">caseDefinitions</span> <span class="tok-o">=</span> <span class="tok-n">cmmnRepositoryService</span><span class="tok-o">.</span><span class="tok-na">createCaseDefinitionQuery</span><span class="tok-o">().</span><span class="tok-na">list</span><span class="tok-o">();</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Found &quot;</span> <span class="tok-o">+</span> <span class="tok-n">caseDefinitions</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot; case definitions&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Having a <strong>CaseDefinition</strong> in the engine, it&#8217;s now possible to start a <strong>CaseInstance</strong> for this case model definition. Either the result from the query is used and passed into the following snippet of code, or the <em>key</em> of the case definition is used directly (as done below).</p>
</div>
<div class="paragraph">
<p>Note that we&#8217;re also passing data, an identifier to the <em>potentialEmployee</em> as a variable when starting the <strong>CaseInstance</strong>. This variable will later be used in the human tasks to assign the task to the correct person (see the <em>assignee="${potentialEmployee}"</em> attribute on <em>human tasks</em>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">CmmnRuntimeService</span> <span class="tok-n">cmmnRuntimeService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnRuntimeService</span><span class="tok-o">();</span>
<span class="tok-n">CaseInstance</span> <span class="tok-n">caseInstance</span> <span class="tok-o">=</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">.</span><span class="tok-na">createCaseInstanceBuilder</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">caseDefinitionKey</span><span class="tok-o">(</span><span class="tok-s">&quot;employeeOnboarding&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">variable</span><span class="tok-o">(</span><span class="tok-s">&quot;potentialEmployee&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;johnDoe&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>After the <strong>CaseInstance</strong> is started, the engine will determine which of the plan items of the model should be activated:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The first stage has no entry criteria, so it&#8217;s activated</p>
</li>
<li>
<p>The child human tasks of the first stage have no entry criteria, so three of them are expected to be active</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The plan items are represented at runtime by <strong>PlanItemInstances</strong> and can be queried through the <em>CmmnRuntimeService</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">PlanItemInstance</span><span class="tok-o">&gt;</span> <span class="tok-n">planItemInstances</span> <span class="tok-o">=</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">.</span><span class="tok-na">createPlanItemInstanceQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">caseInstanceId</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">())</span>
    <span class="tok-o">.</span><span class="tok-na">orderByName</span><span class="tok-o">().</span><span class="tok-na">asc</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>

<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">PlanItemInstance</span> <span class="tok-n">planItemInstance</span> <span class="tok-o">:</span> <span class="tok-n">planItemInstances</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">planItemInstance</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>which prints out</p>
</div>
<div class="listingblock">
<div class="content">
<pre>After starting
Agree start date
Allocate office
Create email address
Prior to starting
Reject job
Send joining letter to candidate</pre>
</div>
</div>
<div class="paragraph">
<p>Some things might be unexpected here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The stages are <em>also</em> plan items and thus have a representation as <strong>PlanItemInstance</strong>. Note that that child plan item instances will have the stage as parent when calling <em>.getStageInstanceId()</em>.</p>
</li>
<li>
<p>The <em>Send joining letter to candidate</em> is returned in the result. The reason for that is that, in accordance with the CMMN 1.1 specification, this plan item instance is in the <em>available</em> state, but not yet in the <em>active</em> state.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Indeed, when the code above is changed to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">PlanItemInstance</span> <span class="tok-n">planItemInstance</span> <span class="tok-o">:</span> <span class="tok-n">planItemInstances</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">planItemInstance</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">()</span>
        <span class="tok-o">+</span> <span class="tok-s">&quot;, state=&quot;</span> <span class="tok-o">+</span> <span class="tok-n">planItemInstance</span><span class="tok-o">.</span><span class="tok-na">getState</span><span class="tok-o">()</span>
        <span class="tok-o">+</span> <span class="tok-s">&quot;, parent stage=&quot;</span> <span class="tok-o">+</span> <span class="tok-n">planItemInstance</span><span class="tok-o">.</span><span class="tok-na">getStageInstanceId</span><span class="tok-o">());</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output now becomes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>After starting, state=available, parent stage=null
Agree start date, state=active, parent stage=fe37ac97-b016-11e7-b3ad-acde48001122
Allocate office, state=active, parent stage=fe37ac97-b016-11e7-b3ad-acde48001122
Create email address, state=active, parent stage=fe37ac97-b016-11e7-b3ad-acde48001122
Prior to starting, state=active, parent stage=null
Reject job, state=active, parent stage=fe37ac97-b016-11e7-b3ad-acde48001122
Send joining letter to candidate, state=available, parent stage=fe37ac97-b016-11e7-b3ad-acde48001122</pre>
</div>
</div>
<div class="paragraph">
<p>To only show the active plan item instances, the query can be adapted by adding <em>planItemInstanceStateActive()</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">PlanItemInstance</span><span class="tok-o">&gt;</span> <span class="tok-n">planItemInstances</span> <span class="tok-o">=</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">.</span><span class="tok-na">createPlanItemInstanceQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">caseInstanceId</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">())</span>
    <span class="tok-o">.</span><span class="tok-na">planItemInstanceStateActive</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">orderByName</span><span class="tok-o">().</span><span class="tok-na">asc</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output is now</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Agree start date
Allocate office
Create email address
Prior to starting
Reject job</pre>
</div>
</div>
<div class="paragraph">
<p>Of course, the <strong>PlanItemInstance</strong> is the low level representation, but each plan item also has a <em>plan item definition</em> that defines what type it is. In this case, we only have <em>human tasks</em>. It is possible to interact with the <em>CaseInstance</em> via its <em>plan item instances</em>, for example by triggering them programmatically (e.g. <em>CmmnRuntimeService.triggerPlanItemInstance(String planItemInstanceId)</em>). However, most likely the interaction will happen through the results of the actual plan item definition, here the human tasks.</p>
</div>
<div class="paragraph">
<p>Querying for tasks is done in the exact same way as for the BPMN engine (in fact, the task service is a shared component and tasks created in BPMN or CMMN can be queried through both engines):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span></span><span class="tok-n">CmmnTaskService</span> <span class="tok-n">cmmnTaskService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnTaskService</span><span class="tok-o">();</span>
<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-n">hrTasks</span> <span class="tok-o">=</span> <span class="tok-n">cmmnTaskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">taskCandidateGroup</span><span class="tok-o">(</span><span class="tok-s">&quot;hr&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">caseInstanceId</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">())</span>
    <span class="tok-o">.</span><span class="tok-na">orderByTaskName</span><span class="tok-o">().</span><span class="tok-na">asc</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">:</span> <span class="tok-n">hrTasks</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Task for HR : &quot;</span> <span class="tok-o">+</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>
<span class="tok-o">}</span>

<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-n">employeeTasks</span> <span class="tok-o">=</span> <span class="tok-n">cmmnTaskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">taskAssignee</span><span class="tok-o">(</span><span class="tok-s">&quot;johndoe&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">orderByTaskName</span><span class="tok-o">().</span><span class="tok-na">asc</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">:</span> <span class="tok-n">employeeTasks</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Task for employee: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">task</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which outputs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Task for HR : Agree start date
Task for HR : Allocate office
Task for HR : Create email address

Task for employee: Reject job</pre>
</div>
</div>
<div class="paragraph">
<p>When the three tasks of HR are completed, the <em>Send joining letter to candidate</em> task should be available:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">:</span> <span class="tok-n">hrTasks</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">cmmnTaskService</span><span class="tok-o">.</span><span class="tok-na">complete</span><span class="tok-o">(</span><span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">());</span>
<span class="tok-o">}</span>

<span class="tok-n">hrTasks</span> <span class="tok-o">=</span> <span class="tok-n">cmmnTaskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">taskCandidateGroup</span><span class="tok-o">(</span><span class="tok-s">&quot;hr&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">caseInstanceId</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">())</span>
    <span class="tok-o">.</span><span class="tok-na">orderByTaskName</span><span class="tok-o">().</span><span class="tok-na">asc</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>

<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">:</span> <span class="tok-n">hrTasks</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Task for HR : &quot;</span> <span class="tok-o">+</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>And indeed, the expected task is now created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Task for HR : Send joining letter to candidate</pre>
</div>
</div>
<div class="paragraph">
<p>Completing this task will now move the case instance into the second stage, as the sentry for the first stage is satisfied. The <em>Reject job</em> tasks is automatically completed by the system and the two tasks for the employee are now created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-n">Task</span> <span class="tok-k">for</span> <span class="tok-n">employee</span><span class="tok-o">:</span> <span class="tok-n">Fill</span> <span class="tok-n">in</span> <span class="tok-n">paperwork</span>
<span class="tok-n">Task</span> <span class="tok-k">for</span> <span class="tok-n">employee</span><span class="tok-o">:</span> <span class="tok-n">New</span> <span class="tok-n">starter</span> <span class="tok-n">training</span>
<span class="tok-n">Task</span> <span class="tok-k">for</span> <span class="tok-n">employee</span><span class="tok-o">:</span> <span class="tok-n">Reject</span> <span class="tok-n">job</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Completing all the tasks will now end the case instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>List&lt;Task&gt; tasks = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).listPage(0, 1);
while (!tasks.isEmpty()) {
    cmmnTaskService.complete(tasks.get(0).getId());
    tasks = cmmnTaskService.createTaskQuery()
        .caseInstanceId(caseInstance.getId())
        .listPage(0, 1);
}</pre>
</div>
</div>
<div class="paragraph">
<p>While executing case instances, the engine also stores historic information, that can be queried via a query API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span></span><span class="tok-n">CmmnHistoryService</span> <span class="tok-n">cmmnHistoryService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnHistoryService</span><span class="tok-o">();</span>
<span class="tok-n">HistoricCaseInstance</span> <span class="tok-n">historicCaseInstance</span> <span class="tok-o">=</span> <span class="tok-n">cmmnHistoryService</span><span class="tok-o">.</span><span class="tok-na">createHistoricCaseInstanceQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">caseInstanceId</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">())</span>
    <span class="tok-o">.</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>

<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Case instance execution took &quot;</span>
    <span class="tok-o">+</span> <span class="tok-o">(</span><span class="tok-n">historicCaseInstance</span><span class="tok-o">.</span><span class="tok-na">getEndTime</span><span class="tok-o">().</span><span class="tok-na">getTime</span><span class="tok-o">()</span> <span class="tok-o">-</span> <span class="tok-n">historicCaseInstance</span><span class="tok-o">.</span><span class="tok-na">getStartTime</span><span class="tok-o">().</span><span class="tok-na">getTime</span><span class="tok-o">())</span> <span class="tok-o">+</span> <span class="tok-s">&quot; ms&quot;</span><span class="tok-o">);</span>

<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">HistoricTaskInstance</span><span class="tok-o">&gt;</span> <span class="tok-n">historicTaskInstances</span> <span class="tok-o">=</span> <span class="tok-n">cmmnHistoryService</span><span class="tok-o">.</span><span class="tok-na">createHistoricTaskInstanceQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">caseInstanceId</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">())</span>
    <span class="tok-o">.</span><span class="tok-na">orderByTaskCreateTime</span><span class="tok-o">().</span><span class="tok-na">asc</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>

<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">HistoricTaskInstance</span> <span class="tok-n">historicTaskInstance</span> <span class="tok-o">:</span> <span class="tok-n">historicTaskInstances</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Task completed: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">historicTaskInstance</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which outputs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Case instance execution took 149 ms
Task completed: Reject job
Task completed: Agree start date
Task completed: Allocate office
Task completed: Create email address
Task completed: Send joining letter to candidate
Task completed: New starter training
Task completed: Fill in paperwork</pre>
</div>
</div>
<div class="paragraph">
<p>Of course, this is but a small part of the available API&#8217;s and constructs available in the Flowable CMMN Engine. Please check the other sections for more detailed information</p>
</div>
</div>
<div class="sect2">
<h3 id="_cmmn_1_1_constructs">6.4. CMMN 1.1 Constructs</h3>
<div class="paragraph">
<p>This chapter covers the CMMN 1.1 constructs supported by Flowable, as well as extensions to the CMMN 1.1 standard.</p>
</div>
<div class="sect3">
<h4 id="_stage">6.4.1. Stage</h4>
<div class="paragraph">
<p>A stage is used to group plan items together. It is typically used to define "phases" in a case instance.</p>
</div>
<div class="paragraph">
<p>A stage is a plan item itself, and thus can have entry and exit criteria. Plan items contained within a stage are only available when the parent stage moves to the <em>active</em> state. Stages can be nested in other stages.</p>
</div>
<div class="paragraph">
<p>A stage is visualized as a rectangle with angled corners:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.stage.png" alt="cmmn.stage">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_task">6.4.2. Task</h4>
<div class="paragraph">
<p>A "manual" task, meaning the task will happen external to the engine.</p>
</div>
<div class="paragraph">
<p>Properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: expression that will be resolved at runtime as the name of the human task</p>
</li>
<li>
<p><strong>blocking</strong>: a boolean value determining whether the task blocks</p>
</li>
<li>
<p><strong>blockingExpression</strong>: an expression that evaluates to a boolean indicating whether the tasks blocks</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a task is non-blocking, the engine will simply complete it automatically when executing it. If a task is blocking, a <em>PlanItemInstance</em> for this task will remain in the <em>active</em> state until it is programmatically triggered by the <em>CmmnRuntimeService.triggerPlanItemInstance(String planItemInstanceId)</em> method.</p>
</div>
<div class="paragraph">
<p>A task is visualized as a rounded rectangle:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.task.png" alt="cmmn.task">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_human_task">6.4.3. Human task</h4>
<div class="paragraph">
<p>A human task is used to model work that needs to be done by a human, typically through a form. When the engine arrives at such a human task, a new entry is created in the task list of any users or groups assigned to that task.</p>
</div>
<div class="paragraph">
<p>A human task is a plan item, which means that beyond a human task entry aso a <em>PlanItemInstance</em> is created and it can be queried via the <em>PlanItemInstanceQuery</em>.</p>
</div>
<div class="paragraph">
<p>Human tasks can be queried through the <em>org.flowable.task.api.TaskQuery</em> API. Historic task data can be queries through the <em>org.flowable.task.api.history.HistoricTaskInstanceQuery</em>.</p>
</div>
<div class="paragraph">
<p>Properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: expression that will be resolved at runtime as the name of the human task.</p>
</li>
<li>
<p><strong>blocking</strong>: a boolean value determining whether the task blocks.</p>
</li>
<li>
<p><strong>blockingExpression</strong>: an expression that evaluates to a boolean indicating whether the tasks blocks.</p>
</li>
<li>
<p><strong>assignee</strong> : an expression (can be a static text value) that is used to determine to who the human task is assigned.</p>
</li>
<li>
<p><strong>owner</strong> : an expression (can be a static text value) that is used to determine to who is the owner of the human task.</p>
</li>
<li>
<p><strong>candidateUsers</strong> : an expression (can be a static text value) that resolves to a comma-separated list of Strings that is used to determine which users are candidate for this human task.</p>
</li>
<li>
<p><strong>candidateGroups</strong> : an expression (can be a static text value) that resolves to a comma-separated list of Strings that is used to determine to which groups the task is assigned.</p>
</li>
<li>
<p><strong>form key</strong>: an expression that determines a key when using forms. Can be retrieved via the API afterwards.</p>
</li>
<li>
<p><strong>Due date</strong> an expression that resolves to java.util.Date or a ISO-8601 date string.</p>
</li>
<li>
<p><strong>Priority</strong>: an expression that resolves to an integer. Can be used in the TaskQuery API to filter tasks.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A human task is visualized as a rounded rectangle with a user icon in the top left corner:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.humantask.png" alt="cmmn.humantask">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_java_service_task">6.4.4. Java Service task</h4>
<div class="paragraph">
<p>A service task is used to execute custom logic.</p>
</div>
<div class="paragraph">
<p>Custom logic is placed in a class that implements the <em>org.flowable.cmmn.api.delegate.PlanItemJavaDelegate</em> interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyJavaDelegate</span> <span class="tok-kd">implements</span> <span class="tok-n">PlanItemJavaDelegate</span> <span class="tok-o">{</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">execute</span><span class="tok-o">(</span><span class="tok-n">DelegatePlanItemInstance</span> <span class="tok-n">planItemInstance</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">String</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">)</span> <span class="tok-n">planItemInstance</span><span class="tok-o">.</span><span class="tok-na">getVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;someVariable&quot;</span><span class="tok-o">);</span>
        <span class="tok-o">...</span>
    <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>For lower-level implementations that cannot be covered by using the <em>PlanItemJavaDelegate</em> approach, the <em>CmmnActivityBehavior</em> can be used (similar to <em>JavaDelegate</em> vs <em>ActivityBehavior</em> in the BPMN engine).</p>
</div>
<div class="paragraph">
<p>Properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: name of the service task.</p>
</li>
<li>
<p><strong>class</strong>: the Java class implementing the custom logic.</p>
</li>
<li>
<p><strong>class fields</strong>: allows to add parameters when calling the custom logic.</p>
</li>
<li>
<p><strong>Delegate expression</strong>: an expression that resolves to a class implementing the <em>PlanItemJavaDelegate</em> interface.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A service task is visualized as a rounded rectangle with a cog icon in the top left corner:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.servicetask.png" alt="cmmn.servicetask">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_decision_task">6.4.5. Decision task</h4>
<div class="paragraph">
<p>A <em>Decision task</em> allows to call out to a DMN decision table and store the resulting variable in the case instance.</p>
</div>
<div class="paragraph">
<p>Properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Decision table reference</strong>: the referenced DMN decision table that needs to be invoked.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is also possible to throw an error when no rule is hit during the evaluation of the DMN decision table, by setting the <em><em>Throw error if no rules were hit</em></em> property.</p>
</div>
<div class="paragraph">
<p>A decision task is visualized as a <em>task</em> with a table icon in the top left corner:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.decisiontask.png" alt="cmmn.decisiontask">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_http_task">6.4.6. Http Task</h4>
<div class="paragraph">
<p>The Http task is an out-of-the-box implementation of a <em>service task</em>. It is used when a REST service needs to be called over HTTP.</p>
</div>
<div class="paragraph">
<p>The Http task has various options to customize the request and response. See the BPMN http task documentation for details on all the configuration options.</p>
</div>
<div class="paragraph">
<p>A http task is visualized as a <em>task</em> with a rocket icon in the top left corner:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.httptask.png" alt="cmmn.httptask">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_milestone">6.4.7. Milestone</h4>
<div class="paragraph">
<p>A milestone is used to mark arriving at a certain point in the case instance. At runtime, they are represented as <strong>MilestoneInstances</strong> and they can be queried through the <strong>MilestoneInstanceQuery</strong> via the <em>CmmnRuntimeService</em>. There is also a historical counterpart via the <em>CmmnHistoryService</em>.</p>
</div>
<div class="paragraph">
<p>A human task is a plan item, which means that beyond a milestone entry aso a <em>PlanItemInstance</em> is created and it can be queried via the <em>PlanItemInstanceQuery</em>.</p>
</div>
<div class="paragraph">
<p>Properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: an expression or static text that determines the name of the mile stone.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A milestone is visualized as a rounded rectangle with, slightly more rounded than a task:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.milestone.png" alt="cmmn.milestone">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_case_task">6.4.8. Case task</h4>
<div class="paragraph">
<p>A case task is used to start a child case within the context of another case. The <em>CaseInstanceQuery</em> has <em>parent</em> options to find these cases.</p>
</div>
<div class="paragraph">
<p>When the case task is blocking, the <em>PlanItemInstance</em> will be <em>active</em> until the child case has completely finished. If the case task is non-blocking, the child case is started and the plan item instance automatically completes. When the child case instance is ended, there is no impact on the parent case.</p>
</div>
<div class="paragraph">
<p>Properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: an expression or static text that determines the name</p>
</li>
<li>
<p><strong>blocking</strong>: a boolean value determining whether the task blocks</p>
</li>
<li>
<p><strong>blockingExpression</strong>: an expression that evaluates to a boolean indicating whether the tasks blocks</p>
</li>
<li>
<p><strong>Case reference</strong>: the key of the case definition that is used to start the child case instance. Can be an expression.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A case task is visualized as a rounded rectangle with a case icon in the top left corner:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.casetask.png" alt="cmmn.casetask">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_process_task">6.4.9. Process task</h4>
<div class="paragraph">
<p>A process task is used to start a process instance within the context of a case.</p>
</div>
<div class="paragraph">
<p>When the process task is blocking, the <em>PlanItemInstance</em> will be <em>active</em> until the process instance has completely finished. If the process task is non-blocking, the process instance is started and the plan item instance automatically completes. When the process instance is ended, there is no impact on the parent case.</p>
</div>
<div class="paragraph">
<p>Properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: an expression or static text that determines the name</p>
</li>
<li>
<p><strong>blocking</strong>: a boolean value determining whether the task blocks</p>
</li>
<li>
<p><strong>blockingExpression</strong>: an expression that evaluates to a boolean indicating whether the tasks blocks</p>
</li>
<li>
<p><strong>Process reference</strong>: the key of the process definition that is used to start the process instance. Can be an expression.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A process task is visualized as a rounded rectangle with an arrow icon in the top left corner:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.processtask.png" alt="cmmn.processtask">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_criteria">6.4.10. Criteria</h4>
<div class="sect4">
<h5 id="_entry_criterion">Entry criterion</h5>
<div class="paragraph">
<p>Entry criteria form a sentry for a given plan item instance. They consist of two parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One or more parts depending on other plan items: these define dependencies on state transitions of other plan items. For example, one human task can depend on the state transition <em>complete</em> of three other human tasks to become active itself.</p>
</li>
<li>
<p>One optional <em>if part</em> or <em>condition</em>: this is an expression that allows to define a complex condition.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A sentry is satisfied when all of its criteria are resolved to true. When a certain criteria evaluates to true, this is stored and remembered for future evaluations. Note that entry criteria evaluations of all plan item instances in the <em>available</em> state are executed whenever something changes in the case instance.</p>
</div>
<div class="paragraph">
<p>Multiple sentries are possible on a plan item. However, when one is satisfied, the plan item moves from state <em>available</em> to <em>active</em>.</p>
</div>
<div class="paragraph">
<p>An entry criteria is visualized as a diamond shape (white color inside) on the border of a plan item:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.entrycriteria.png" alt="cmmn.entrycriteria">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_exit_criterion">Exit criterion</h5>
<div class="paragraph">
<p>Exit criteria form a sentry for a given plan item instance. They consist of two parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One or more parts depending on other plan items: these define dependencies on state transitions of other plan items. For example, one human task can depend on reaching a certain milestone to be automatically terminated.</p>
</li>
<li>
<p>One optional <em>if part</em> or <em>condition</em>: this is an expression that allows to define a complex condition.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A sentry is satisfied when all of its criteria are resolved to true. When a certain criteria evaluates to true, this is stored and remembered for future evaluations. Note that exit criteria evaluations of all plan item instances in the <em>active</em> state are executed whenever something changes in the case instance.</p>
</div>
<div class="paragraph">
<p>Multiple sentries are possible on a plan item. However, when one is satisfied, the plan item moves from state <em>active</em> to <em>exit</em>.</p>
</div>
<div class="paragraph">
<p>An exit criteria is visualized as a diamond shape (white color inside) on the border of a plan item:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.exitcriteria.png" alt="cmmn.exitcriteria">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_event_listeners">6.4.11. Event Listeners</h4>
<div class="sect4">
<h5 id="_timer_event_listener">Timer Event Listener</h5>
<div class="paragraph">
<p>A timer event listener is used when the passing of time needs to be captured in a case model.</p>
</div>
<div class="paragraph">
<p>A timer event listener is not a task and has a simpler plan item lifecycle compared to a <em>task</em>: the timer will simply move from <em>available</em> to <em>completed</em> when the event (in this case, the time passing) occurs.</p>
</div>
<div class="paragraph">
<p>Properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Timer expression</strong>: an expression that defines when the timer should occur. Following options are possible:</p>
<div class="ulist">
<ul>
<li>
<p>An expression resolving to a java.util.Date or org.joda.time.DateTime instance (for example _${someBean.calculateNextDate(someCaseInstanceVariable)})</p>
</li>
<li>
<p>An ISO8601 date</p>
</li>
<li>
<p>An ISO8601 duration String (for example <em>PT5H</em>, indicating the timer should fire in 5 hours from instantiation)</p>
</li>
<li>
<p>AN ISO8601 repetition String (for example R5/PT2H, indicating the timer should fire 5 times, each time waiting 2 hours)</p>
</li>
<li>
<p>A String containing a cron expression</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Start trigger plan item/event</strong>: allows to reference a plan item in the case model that triggers the start of the timer event listener.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that setting a <em>start trigger</em> for the timer event listener does not have a visual indication in the case model, as entry/exit criteria on sentries do have.</p>
</div>
<div class="paragraph">
<p>A timer event listener is visualized as circle with a clock icon inside:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.timereventlistener.png" alt="cmmn.timereventlistener">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_item_controls">6.4.12. Item controls</h4>
<div class="sect4">
<h5 id="_repetition_rule">Repetition Rule</h5>
<div class="paragraph">
<p>Plan items on the case model can have a <em>repetition rule</em>, an expression that can be used to indicate a certain plan item needs to be repeated.</p>
</div>
<div class="paragraph">
<p>An optional <em>repetition counter variable</em> can be set, that holds the index (one-based) of the instance. If not set, the default variable name is <em>repeitionCounter</em>.</p>
</div>
<div class="paragraph">
<p>If the plan item does not have any entry criteria, the repetition rule expression is evaluated when the plan item is completed or terminated. If the expression resolved to <em>true</em>, a new instance is created. For example, a human task with a repetition rule expression <em>${repetitionCounter &lt; 3}</em>, will create three sequential human tasks.</p>
</div>
<div class="paragraph">
<p>If the plan item does have entry criteria, the behavior is different. The repetition rule is not evaluated on completion or termination, but when a sentry of the plan item is satisfied. If both the sentry is satisfied and the repetition rule evaluates to true, a new instance is created.</p>
</div>
<div class="paragraph">
<p>Take for example the following timer event listener followed by a human task. The sentry has one entry criteria for the <em>occur</em> event of the timer event listener. Note that enabling and setting the repetition rule on the task has a visual indication at the bottom of the rectangle.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.repeatingtimereventlistener.png" alt="cmmn.repeatingtimereventlistener">
</div>
</div>
<div class="paragraph">
<p>If the timer event listener is repeating (for example <em>R/PT1H</em>), the <em>occur</em> event will be fired every hour. When the repetition rule expression of the human task evaluates to true, a new human task instance will be created each hour.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</body>
</html>